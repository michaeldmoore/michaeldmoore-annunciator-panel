{"version":3,"sources":["../src/module.js"],"names":["MetricsPanelCtrl","_","$","angular","kbn","config","TimeSeries","appEvents","AnnunciatorPanelCtrl","$scope","$injector","panelDefaults","panel","elem","ctrl","defaults","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","err","emit","seriesList","render","metricNames","fontSizes","fontSizes0","concat","displayStates","displayStates1","unitFormats","getUnitFormats","addEditorTab","subItem","Metric","Format","value","valueRegion","UpperLimit","DisplayOption","Value","UpperWarning","LowerLimit","LowerWarning","metric","displayAttributes","color","Color","displayOption","flash","getValueRegion","data","html","Prefix","Text","FontSize","getTextSpan","getValueSpan","Decimals","Postfix","buildLimitsHtml","isNumeric","buildValueHtml","sparkline","show","addSparkline","className","fontSize","text","style","replace","decimals","getDisplayAttributesForValue","formatValue","OKLowerLimit","Number","OKUpperLimit","MetricValueRange","dataList","length","datapoints","dataPoints","filter","dp","range","from","to","series","map","seriesHandler","setValues","buildHtml","setOKValueRange","renderingCompleted","seriesData","alias","target","flotpairs","getFlotPairs","nullPointMode","isNumber","scaledDecimals","delta","dec","Math","floor","log","LN10","magn","pow","norm","size","result","max","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","JSON","stringify","lastPoint","last","lastValue","isArray","isString","valueFormatted","escape","valueRounded","stats","Name","roundValue","width","setTimeout","height","plotCanvas","plotCss","position","full","bottom","left","dynamicHeightMargin","round","css","options","legend","lines","fill","lineWidth","fillColor","yaxes","xaxis","mode","min","valueOf","grid","hoverable","find","append","plotSeries","lineColor","plot","refresh","scope","attrs","panelContentElem","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGIA,4B,kBAAAA,gB;;AAKGC,a;;AACAC,a;;AAEAC,mB;;AACAC,e;;AACAC,kB;;AACAC,sB;;AAEHC,qB,gBAAAA,S;;;;;;;;;;;;;;;;;;;;;iCAGEC,oB;;;AAEF;AACA,8CAAYC,MAAZ,EAAoBC,SAApB,EAA+B;AAAA;;AAAA,4JACrBD,MADqB,EACbC,SADa;;AAG3B,wBAAIC,gBAAgB;AAChB,sCAAc;AACV,6CAAiB,UADP;AAEV,qCAAS,iBAFC;AAGV,qCAAS,EAHC;AAIV,wCAAY,CAJF;AAKV,wCAAY;AALF,yBADE;AAQhB,wCAAgB;AACZ,6CAAiB,UADL;AAEZ,qCAAS,kBAFG;AAGZ,qCAAS;AAHG,yBARA;AAahB,kCAAU;AACN,oCAAQ,SADF;AAEN,sCAAU,SAFJ;AAGN,qCAAS,gBAHH;AAIN,wCAAY,CAJN;AAKN,wCAAY;AALN,yBAbM;AAoBhB,wCAAgB;AACZ,6CAAiB,UADL;AAEZ,qCAAS,gBAFG;AAGZ,qCAAS;AAHG,yBApBA;AAyBhB,sCAAc;AACV,6CAAiB,UADP;AAEV,qCAAS,iBAFC;AAGV,qCAAS,EAHC;AAIV,wCAAY,CAJF;AAKV,wCAAY;AALF,yBAzBE;AAgChB,kCAAU;AACN,oCAAQ,EADF;AAEN,wCAAY;AAFN,yBAhCM;AAoChB,mCAAW;AACP,oCAAQ,EADD;AAEP,wCAAY;AAFL,yBApCK;AAwChB,qCAAa;AACT,yCAAa,yBADJ;AAET,oCAAQ,KAFC;AAGT,yCAAa,mBAHJ;AAIT,oCAAQ;AAJC;AAxCG,qBAApB;;AAgDA,wBAAIC,QAAQ,EAAZ;AACA,wBAAIC,OAAO,EAAX;AACA,wBAAIC,OAAO,EAAX;;AAEAb,sBAAEc,QAAF,CAAW,MAAKH,KAAhB,EAAuBD,aAAvB;;AAEA,0BAAKK,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKC,QAAL,CAAcC,IAAd,OAAzB;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKG,cAAL,CAAoBD,IAApB,OAAhC;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKI,WAAL,CAAiBF,IAAjB,OAA7B;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKK,cAAL,CAAoBH,IAApB,OAAjC;AA5D2B;AA6D9B;;;;gDAEWI,G,EAAK;AACbhB,kCAAUiB,IAAV,CAAe,aAAf,EAA8B,CAAC,wBAAD,EAA2BD,GAA3B,CAA9B;AACA,6BAAKE,UAAL,GAAkB,EAAlB;AACA,6BAAKC,MAAL,CAAY,EAAZ;AACH;;;qDAEgB;AACb,6BAAKC,WAAL,GAAmB,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,SAAtB,EAAiC,OAAjC,EAA0C,OAA1C,EAAmD,OAAnD,EAA4D,MAA5D,EAAoE,OAApE,CAAnB;AACA,6BAAKC,SAAL,GAAiB,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,KAAtB,EAA6B,KAA7B,EAAoC,MAApC,EAA4C,MAA5C,EAAoD,MAApD,EAA4D,MAA5D,EAAoE,MAApE,EAA4E,MAA5E,CAAjB;AACA,6BAAKC,UAAL,GAAkB,CAAC,MAAD,EAASC,MAAT,CAAgB,KAAKF,SAArB,CAAlB;AACA,6BAAKG,aAAL,GAAqB,CAAC,UAAD,EAAa,QAAb,CAArB;AACA,6BAAKC,cAAL,GAAsB,KAAKD,aAAL,CAAmBD,MAAnB,CAA0B,CAAC,OAAD,EAAU,aAAV,CAA1B,CAAtB;AACA,6BAAKG,WAAL,GAAmB7B,IAAI8B,cAAJ,EAAnB;AACA,6BAAKC,YAAL,CAAkB,SAAlB,EAA6B,6DAA7B,EAA4F,CAA5F;AACH;;;kDAEaC,O,EAAS;AACnB,6BAAKxB,KAAL,CAAWyB,MAAX,CAAkBC,MAAlB,GAA2BF,QAAQG,KAAnC;AACA,6BAAKb,MAAL;AACH;;;mDAEca,K,EAAO;AAClB,4BAAIC,cAAc,IAAlB;;AAEA,4BAAI,KAAK5B,KAAL,CAAW6B,UAAX,CAAsBC,aAAtB,IAAuC,UAA3C,EAAuD;AACnD,gCAAIH,SAAS,KAAK3B,KAAL,CAAW6B,UAAX,CAAsBE,KAAnC,EACIH,cAAc,YAAd,CADJ,KAEK,IAAI,KAAK5B,KAAL,CAAWgC,YAAX,CAAwBF,aAAxB,IAAyC,UAAzC,IAAwDH,SAAS,KAAK3B,KAAL,CAAWgC,YAAX,CAAwBD,KAA7F,EACDH,cAAc,cAAd;AACP;;AAED,4BAAI,KAAK5B,KAAL,CAAWiC,UAAX,CAAsBH,aAAtB,IAAuC,UAA3C,EAAuD;AACnD,gCAAIH,SAAS,KAAK3B,KAAL,CAAWiC,UAAX,CAAsBF,KAAnC,EACIH,cAAc,YAAd,CADJ,KAEK,IAAI,KAAK5B,KAAL,CAAWkC,YAAX,CAAwBJ,aAAxB,IAAyC,UAAzC,IAAwDH,SAAS,KAAK3B,KAAL,CAAWkC,YAAX,CAAwBH,KAA7F,EACDH,cAAc,cAAd;AACP;;AAED,+BAAOA,WAAP;AACH;;;iEAE4BD,K,EAAOQ,M,EAAQ;AACxC,4BAAIC,oBAAoB,EAAxB;AACA,4BAAIC,QAAQ,KAAKrC,KAAL,CAAWyB,MAAX,CAAkBa,KAA9B;AACA,4BAAIC,gBAAgB,KAAKvC,KAAL,CAAWyB,MAAX,CAAkBK,aAAtC;AACA,4BAAIU,QAAQ,KAAZ;;AAEA,4BAAIZ,cAAc,KAAKa,cAAL,CAAoB,KAAKC,IAAL,CAAUf,KAA9B,CAAlB;AACA,gCAAQC,WAAR;AACI,iCAAK,YAAL;AACIS,wCAAQ,KAAKrC,KAAL,CAAW6B,UAAX,CAAsBS,KAA9B;AACAC,gDAAgB,KAAKvC,KAAL,CAAW6B,UAAX,CAAsBC,aAAtC;AACA;;AAEJ,iCAAK,cAAL;AACIO,wCAAQ,KAAKrC,KAAL,CAAWgC,YAAX,CAAwBM,KAAhC;AACAC,gDAAgB,KAAKvC,KAAL,CAAWgC,YAAX,CAAwBF,aAAxC;AACA;;AAEJ,iCAAK,cAAL;AACIO,wCAAQ,KAAKrC,KAAL,CAAWkC,YAAX,CAAwBI,KAAhC;AACAC,gDAAgB,KAAKvC,KAAL,CAAWkC,YAAX,CAAwBJ,aAAxC;AACA;;AAEJ,iCAAK,YAAL;AACIO,wCAAQ,KAAKrC,KAAL,CAAWiC,UAAX,CAAsBK,KAA9B;AACAC,gDAAgB,KAAKvC,KAAL,CAAWiC,UAAX,CAAsBH,aAAtC;AACA;AAnBR;;AAsBA,gCAAQK,MAAR;AACI,iCAAK,YAAL;AACIE,wCAAQ,KAAKrC,KAAL,CAAW6B,UAAX,CAAsBS,KAA9B;AACA,oCAAIC,iBAAiB,aAArB,EACIA,gBAAgB,OAAhB;AACJ,oCAAIX,eAAe,YAAnB,EACIW,gBAAgB,QAAhB;AACJ;;AAEJ,iCAAK,YAAL;AACIF,wCAAQ,KAAKrC,KAAL,CAAWiC,UAAX,CAAsBK,KAA9B;AACA,oCAAIC,iBAAiB,aAArB,EACIA,gBAAgB,OAAhB;AACJ,oCAAIX,eAAe,YAAnB,EACIW,gBAAgB,QAAhB;AACJ;AAfR;;AAkBAH,0CAAkBC,KAAlB,GAA0BA,KAA1B;AACAD,0CAAkBG,aAAlB,GAAkCA,aAAlC;;AAEA,+BAAOH,iBAAP;AACH;;;qDAEgB;AACb,4BAAIO,OAAO,EAAX;;AAEAA,gCAAQ,+DAAR;AACA,4BAAI,KAAK3C,KAAL,CAAW4C,MAAX,CAAkBC,IAAlB,IAA0B,EAA1B,IAAgC,KAAK7C,KAAL,CAAW4C,MAAX,CAAkBE,QAAlB,IAA8B,MAAlE,EACIH,QAAQ,KAAKI,WAAL,CAAiB,wCAAjB,EAA2D,KAAK/C,KAAL,CAAW4C,MAAX,CAAkBE,QAA7E,EAAuF,KAAK9C,KAAL,CAAW4C,MAAX,CAAkBC,IAAzG,EAA+G,EAA/G,CAAR;;AAEJF,gCAAQ,KAAKK,YAAL,CAAkB,uCAAlB,EAA2D,KAAKhD,KAAL,CAAWyB,MAAX,CAAkBqB,QAA7E,EAAuF,KAAK9C,KAAL,CAAWyB,MAAX,CAAkBwB,QAAzG,EAAmH,KAAKP,IAAL,CAAUf,KAA7H,EAAoI,OAApI,CAAR;;AAEA,4BAAI,KAAK3B,KAAL,CAAWkD,OAAX,CAAmBL,IAAnB,IAA2B,EAA3B,IAAiC,KAAK7C,KAAL,CAAWkD,OAAX,CAAmBJ,QAAnB,IAA+B,MAApE,EACIH,QAAQ,KAAKI,WAAL,CAAiB,yCAAjB,EAA4D,KAAK/C,KAAL,CAAWkD,OAAX,CAAmBJ,QAA/E,EAAyF,KAAK9C,KAAL,CAAWkD,OAAX,CAAmBL,IAA5G,EAAkH,EAAlH,CAAR;;AAEJF,gCAAQ,QAAR;;AAEA,+BAAOA,IAAP;AACH;;;sDAEiB;AACd,4BAAIA,OAAO,EAAX;;AAEA,4BAAI,KAAK3C,KAAL,CAAW6B,UAAX,CAAsBC,aAAtB,IAAuC,UAAvC,IAAqD,KAAK9B,KAAL,CAAWiC,UAAX,CAAsBH,aAAtB,IAAuC,UAAhG,EAA4G;AACxGa,oCAAQ,gEAAR;;AAEA,gCAAI,KAAK3C,KAAL,CAAWiC,UAAX,CAAsBH,aAAtB,IAAuC,UAAvC,IAAsD,KAAK9B,KAAL,CAAWiC,UAAX,CAAsBa,QAAtB,IAAkC,MAA5F,EACIH,QAAQ,KAAKK,YAAL,CAAkB,6CAAlB,EAAiE,KAAKhD,KAAL,CAAWiC,UAAX,CAAsBa,QAAvF,EAAiG,KAAK9C,KAAL,CAAWiC,UAAX,CAAsBgB,QAAvH,EAAiI,KAAKjD,KAAL,CAAWiC,UAAX,CAAsBF,KAAvJ,EAA8J,YAA9J,CAAR;;AAEJ,gCAAI,KAAK/B,KAAL,CAAW6B,UAAX,CAAsBC,aAAtB,IAAuC,UAAvC,IAAsD,KAAK9B,KAAL,CAAW6B,UAAX,CAAsBiB,QAAtB,IAAkC,MAA5F,EACIH,QAAQ,KAAKK,YAAL,CAAkB,6CAAlB,EAAiE,KAAKhD,KAAL,CAAW6B,UAAX,CAAsBiB,QAAvF,EAAiG,KAAK9C,KAAL,CAAW6B,UAAX,CAAsBoB,QAAvH,EAAiI,KAAKjD,KAAL,CAAW6B,UAAX,CAAsBE,KAAvJ,EAA8J,YAA9J,CAAR;;AAEJY,oCAAQ,QAAR;;AAEAA,oCAAQ,4BAAR;AACH;AACD,+BAAOA,IAAP;AACH;;;gDAEW;AACR,4BAAIA,OAAO,8EAAX;AACA,4BAAI,KAAKD,IAAL,IAAa,IAAb,IAAqB,KAAKA,IAAL,CAAUf,KAAV,IAAmB,IAA5C,EAAkD;AAC9CgB,oCAAQ,KAAKQ,eAAL,EAAR;AACA,gCAAI7D,EAAE8D,SAAF,CAAY,KAAKV,IAAL,CAAUf,KAAtB,CAAJ,EACIgB,QAAQ,KAAKU,cAAL,EAAR,CADJ,KAGI1D,UAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,gCAA7B,CAAhC;AACP,yBAND,MAOI+B,QAAQ,qEAAR;;AAEJA,gCAAQ,QAAR;;AAEA,6BAAK1C,IAAL,CAAU0C,IAAV,CAAeA,IAAf;;AAEA,4BAAI,KAAK3C,KAAL,CAAWsD,SAAX,CAAqBC,IAAzB,EAA+B;AAC3B,iCAAKC,YAAL;AACH;AACJ;;;gDAEWC,S,EAAWC,Q,EAAUC,I,EAAMvB,iB,EAAmB;AACtD,4BAAIwB,QAAQ,EAAZ;;AAEA,4BAAIF,QAAJ,EACIE,SAAS,eAAeF,QAAf,GAA0B,GAAnC;;AAEJ,4BAAItB,qBAAqBA,kBAAkBC,KAA3C,EACIuB,SAAS,WAAWxB,kBAAkBC,KAA7B,GAAqC,GAA9C;;AAEJ,4BAAIuB,KAAJ,EACIA,QAAQ,aAAaA,KAAb,GAAqB,GAA7B;;AAEJ,4BAAIxB,qBAAqBA,kBAAkBG,aAA3C,EACIkB,aAAa,gCAAgCrB,kBAAkBG,aAAlB,CAAgCsB,OAAhC,CAAwC,KAAxC,EAA+C,KAA/C,CAA7C;;AAEJ,+BAAO,kBAAkBJ,SAAlB,GAA8B,GAA9B,GAAoCG,KAApC,GAA4C,GAA5C,GAAkDD,IAAlD,GAAyD,SAAhE;AACH;;;iDAEYF,S,EAAWC,Q,EAAUI,Q,EAAUnC,K,EAAOQ,M,EAAQ;AACvD,4BAAIC,oBAAoB,KAAK2B,4BAAL,CAAkCpC,KAAlC,EAAyCQ,MAAzC,CAAxB;AACA,+BAAO,KAAKY,WAAL,CAAiBU,SAAjB,EAA4BC,QAA5B,EAAsC,KAAKM,WAAL,CAAiBrC,KAAjB,EAAwBmC,QAAxB,CAAtC,EAAyE1B,iBAAzE,CAAP;AACH;;;sDAEiB;AACd,4BAAI6B,YAAJ;AACA,4BAAI,KAAKjE,KAAL,CAAWiC,UAAX,CAAsBH,aAAtB,IAAuC,UAA3C,EAAuD;AACnD,gCAAIxC,EAAE8D,SAAF,CAAY,KAAKpD,KAAL,CAAWiC,UAAX,CAAsBF,KAAlC,CAAJ,EAA8C;AAC1C,oCAAI,KAAK/B,KAAL,CAAWkC,YAAX,CAAwBJ,aAAxB,IAAyC,UAA7C,EAAyD;AACrD,wCAAIxC,EAAE8D,SAAF,CAAY,KAAKpD,KAAL,CAAWkC,YAAX,CAAwBH,KAApC,CAAJ;AACI,4CAAImC,OAAO,KAAKlE,KAAL,CAAWkC,YAAX,CAAwBH,KAA/B,IAAwCmC,OAAO,KAAKlE,KAAL,CAAWiC,UAAX,CAAsBF,KAA7B,CAA5C,EACIkC,eAAe,KAAKjE,KAAL,CAAWkC,YAAX,CAAwBH,KAAvC,CADJ,KAGIpC,UAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,4DAA7B,CAAhC;AAJR,2CAMIjB,UAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,mCAA7B,CAAhC;AACP,iCARD,MASIqD,eAAe,KAAKjE,KAAL,CAAWiC,UAAX,CAAsBF,KAArC;AACP,6BAXD,MAWO;AACHpC,0CAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,iCAA7B,CAAhC;AACH;AACJ;;AAED,4BAAIuD,YAAJ;AACA,4BAAI,KAAKnE,KAAL,CAAW6B,UAAX,CAAsBC,aAAtB,IAAuC,UAA3C,EAAuD;AACnD,gCAAIxC,EAAE8D,SAAF,CAAY,KAAKpD,KAAL,CAAW6B,UAAX,CAAsBE,KAAlC,CAAJ,EAA8C;AAC1C,oCAAI,KAAK/B,KAAL,CAAWgC,YAAX,CAAwBF,aAAxB,IAAyC,UAA7C,EAAyD;AACrD,wCAAIxC,EAAE8D,SAAF,CAAY,KAAKpD,KAAL,CAAWgC,YAAX,CAAwBD,KAApC,CAAJ;AACI,4CAAImC,OAAO,KAAKlE,KAAL,CAAWgC,YAAX,CAAwBD,KAA/B,IAAwCmC,OAAO,KAAKlE,KAAL,CAAW6B,UAAX,CAAsBE,KAA7B,CAA5C,EACIoC,eAAe,KAAKnE,KAAL,CAAWgC,YAAX,CAAwBD,KAAvC,CADJ,KAGIpC,UAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,yDAA7B,CAAhC;AAJR,2CAMIjB,UAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,mCAA7B,CAAhC;AACP,iCARD,MASIuD,eAAe,KAAKnE,KAAL,CAAW6B,UAAX,CAAsBE,KAArC;AACP,6BAXD,MAWO;AACHpC,0CAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,iCAA7B,CAAhC;AACH;AACJ;;AAED,4BAAItB,EAAE8D,SAAF,CAAYa,YAAZ,KAA6B3E,EAAE8D,SAAF,CAAYe,YAAZ,CAAjC,EACI,KAAKnE,KAAL,CAAWoE,gBAAX,GAA8BH,eAAe,MAAf,GAAwBE,YAAtD,CADJ,KAEK,IAAI7E,EAAE8D,SAAF,CAAYa,YAAZ,CAAJ,EACD,KAAKjE,KAAL,CAAWoE,gBAAX,GAA8B,OAAOH,YAArC,CADC,KAEA,IAAI3E,EAAE8D,SAAF,CAAYe,YAAZ,CAAJ,EACD,KAAKnE,KAAL,CAAWoE,gBAAX,GAA8B,OAAOD,YAArC,CADC,KAGD,KAAKnE,KAAL,CAAWoE,gBAAX,GAA8B,EAA9B;AACP;;;+CAEU;AAAA;;AACP,4BAAI1B,OAAO,EAAX;AACA,4BAAI,KAAK2B,QAAL,CAAcC,MAAd,GAAuB,CAA3B,EAA8B;AAC1B,iCAAKD,QAAL,CAAc,CAAd,EAAiBE,UAAjB,GAA8B,KAAKC,UAAL,CAAgBC,MAAhB,CAAuB;AAAA,uCAAMC,GAAG,CAAH,KAAS,OAAKC,KAAL,CAAWC,IAApB,IAA4BF,GAAG,CAAH,KAAS,OAAKC,KAAL,CAAWE,EAAtD;AAAA,6BAAvB,CAA9B;AACA,gCAAI,KAAKR,QAAL,CAAc,CAAd,EAAiBE,UAAjB,CAA4BD,MAA5B,GAAqC,CAAzC,EAA4C;AACxC,qCAAKQ,MAAL,GAAc,KAAKT,QAAL,CAAcU,GAAd,CAAkB,KAAKC,aAAL,CAAmBzE,IAAnB,CAAwB,IAAxB,CAAlB,CAAd;AACA,qCAAK0E,SAAL,CAAevC,IAAf;AACH;AACJ;;AAED,6BAAKA,IAAL,GAAYA,IAAZ;;AAEA,6BAAKwC,SAAL;AACA,6BAAKC,eAAL;AACA,6BAAKjF,IAAL,CAAUkF,kBAAV;AACH;;;mDAGcf,Q,EAAU;AACrB,6BAAKA,QAAL,GAAgBA,QAAhB;AACA,4BAAIA,SAASC,MAAT,GAAkB,CAAtB,EAAyB;AACrB,iCAAKE,UAAL,GAAkBH,SAAS,CAAT,EAAYE,UAA9B;AACH;AACD,6BAAKzD,MAAL;AACH;;;kDAEauE,U,EAAY;AACtB,4BAAIP,SAAS,IAAIpF,UAAJ,CAAe;AACxB6E,wCAAYc,WAAWd,UADC;AAExBe,mCAAOD,WAAWE;AAFM,yBAAf,CAAb;;AAKAT,+BAAOU,SAAP,GAAmBV,OAAOW,YAAP,CAAoB,KAAKzF,KAAL,CAAW0F,aAA/B,CAAnB;AACA,+BAAOZ,MAAP;AACH;;;wDAEmBnD,K,EAAOmC,Q,EAAU;AACjC,4BAAIzE,EAAEsG,QAAF,CAAW7B,QAAX,CAAJ,EAA0B;AACtB,mCAAO;AACHA,0CAAUA,QADP;AAEH8B,gDAAgB;AAFb,6BAAP;AAIH;;AAED,4BAAIC,QAAQlE,QAAQ,CAApB;AACA,4BAAImE,MAAM,CAACC,KAAKC,KAAL,CAAWD,KAAKE,GAAL,CAASJ,KAAT,IAAkBE,KAAKG,IAAlC,CAAX;;AAEA,4BAAIC,OAAOJ,KAAKK,GAAL,CAAS,EAAT,EAAa,CAACN,GAAd,CAAX;AAAA,4BACIO,OAAOR,QAAQM,IADnB;AAAA,4BACyB;AACrBG,4BAFJ;;AAIA,4BAAID,OAAO,GAAX,EAAgB;AACZC,mCAAO,CAAP;AACH,yBAFD,MAEO,IAAID,OAAO,CAAX,EAAc;AACjBC,mCAAO,CAAP;AACA;AACA,gCAAID,OAAO,IAAX,EAAiB;AACbC,uCAAO,GAAP;AACA,kCAAER,GAAF;AACH;AACJ,yBAPM,MAOA,IAAIO,OAAO,GAAX,EAAgB;AACnBC,mCAAO,CAAP;AACH,yBAFM,MAEA;AACHA,mCAAO,EAAP;AACH;;AAEDA,gCAAQH,IAAR;;AAEA;AACA,4BAAIJ,KAAKC,KAAL,CAAWrE,KAAX,MAAsBA,KAA1B,EAAiC;AAC7BmE,kCAAM,CAAN;AACH;;AAED,4BAAIS,SAAS,EAAb;AACAA,+BAAOzC,QAAP,GAAkBiC,KAAKS,GAAL,CAAS,CAAT,EAAYV,GAAZ,CAAlB;AACAS,+BAAOX,cAAP,GAAwBW,OAAOzC,QAAP,GAAkBiC,KAAKC,KAAL,CAAWD,KAAKE,GAAL,CAASK,IAAT,IAAiBP,KAAKG,IAAjC,CAAlB,GAA2D,CAAnF;;AAEA,+BAAOK,MAAP;AACH;;;gDAEW5E,K,EAAOmC,Q,EAAU;AACzB;AACA;AACA;AACA,4BAAI2C,cAAc,KAAKC,mBAAL,CAAyB/E,KAAzB,EAAgCmC,QAAhC,CAAlB;AACA,4BAAI6C,aAAanH,IAAIoH,YAAJ,CAAiB,KAAK5G,KAAL,CAAWyB,MAAX,CAAkBC,MAAnC,CAAjB;AACA,+BAAOiF,WAAWhF,KAAX,EAAkB8E,YAAY3C,QAA9B,EAAwC2C,YAAYb,cAApD,CAAP;AACH;;;8CAESlD,I,EAAM;AACZA,6BAAK8C,SAAL,GAAiB,EAAjB;;AAEA,4BAAI,KAAKV,MAAL,CAAYR,MAAZ,GAAqB,CAAzB,EAA4B;AACxB3E,sCAAUiB,IAAV,CAAe,aAAf,EAA8B,CAAC,mCAAD,EAC1B,0BAA0B,KAAKkE,MAAL,CAAYR,MAAtC,GAA+C,oEAA/C,GAAsHuC,KAAKC,SAAL,CAAe,KAAKhC,MAApB,CAD5F,CAA9B;AAGH;;AAED,4BAAI,KAAKA,MAAL,IAAe,KAAKA,MAAL,CAAYR,MAAZ,GAAqB,CAAxC,EAA2C;AACvC,gCAAIyC,YAAY1H,EAAE2H,IAAF,CAAO,KAAKlC,MAAL,CAAY,CAAZ,EAAeP,UAAtB,CAAhB;AACA,gCAAI0C,YAAY5H,EAAE6H,OAAF,CAAUH,SAAV,IAAuBA,UAAU,CAAV,CAAvB,GAAsC,IAAtD;;AAEA,gCAAI1H,EAAE8H,QAAF,CAAWF,SAAX,CAAJ,EAA2B;AACvBvE,qCAAKf,KAAL,GAAa,CAAb;AACAe,qCAAK0E,cAAL,GAAsB/H,EAAEgI,MAAF,CAASJ,SAAT,CAAtB;AACAvE,qCAAK4E,YAAL,GAAoB,CAApB;AACH,6BAJD,MAIO;AACH5E,qCAAKf,KAAL,GAAa,KAAKmD,MAAL,CAAY,CAAZ,EAAeyC,KAAf,CAAqB,KAAKvH,KAAL,CAAWyB,MAAX,CAAkB+F,IAAvC,CAAb;AACA9E,qCAAK8C,SAAL,GAAiB,KAAKV,MAAL,CAAY,CAAZ,EAAeU,SAAhC;;AAEA,oCAAI9C,QAAQ,IAAR,IAAgBA,KAAKf,KAAL,IAAc,IAAlC,EAAwC;AACpCe,yCAAKf,KAAL,GAAa,GAAb;AACH;;AAED,oCAAI8E,cAAc,KAAKC,mBAAL,CAAyBhE,KAAKf,KAA9B,EAAqC,KAAK3B,KAAL,CAAWyB,MAAX,CAAkBwB,QAAvD,CAAlB;AACA,oCAAI0D,aAAanH,IAAIoH,YAAJ,CAAiB,KAAK5G,KAAL,CAAWyB,MAAX,CAAkBC,MAAnC,CAAjB;AACAgB,qCAAK0E,cAAL,GAAsBT,WAAWjE,KAAKf,KAAhB,EAAuB8E,YAAY3C,QAAnC,EAA6C2C,YAAYb,cAAzD,CAAtB;AACAlD,qCAAK4E,YAAL,GAAoB9H,IAAIiI,UAAJ,CAAe/E,KAAKf,KAApB,EAA2B8E,YAAY3C,QAAvC,CAApB;AACH;;AAED,gCAAIpB,QAAQ,IAAR,IAAgBA,KAAKf,KAAL,IAAc,IAAlC,EAAwC;AACpCe,qCAAKf,KAAL,GAAa,GAAb;AACH;;AAED;AACA;AACA;AACA;AACA;AACH;AACJ;;;mDAEc;AACX,4BAAI,KAAK1B,IAAL,IAAa,IAAb,IAAqB,KAAKA,IAAL,CAAUyH,KAAV,KAAoB,EAA7C,EAAiD;AAC7C;AACA;AACAC,uCAAW,KAAKnE,YAAhB,EAA8B,EAA9B;AACA;AACH;;AAED,4BAAIkE,QAAQ,KAAKzH,IAAL,CAAUyH,KAAV,KAAoB,EAAhC;AACA,4BAAIE,SAAS,KAAK3H,IAAL,CAAU2H,MAAV,EAAb;AACA,4BAAIC,aAAavI,EAAE,aAAF,CAAjB;AACA,4BAAIwI,UAAU,EAAd;AACAA,gCAAQC,QAAR,GAAmB,UAAnB;;AAEA,4BAAI,KAAK/H,KAAL,CAAWsD,SAAX,CAAqB0E,IAAzB,EAA+B;AAC3BF,oCAAQG,MAAR,GAAiB,KAAjB;AACAH,oCAAQI,IAAR,GAAe,MAAf;AACAJ,oCAAQJ,KAAR,GAAiBA,QAAQ,EAAT,GAAe,IAA/B;AACA,gCAAIS,sBAAsBP,UAAU,GAAV,GAAgB,CAAhB,GAAqB7B,KAAKqC,KAAL,CAAYR,SAAS,GAArB,IAA6B,EAA9B,GAAoC,CAAlF;AACAE,oCAAQF,MAAR,GAAkBA,SAASO,mBAAV,GAAiC,IAAlD;AACH,yBAND,MAMO;AACHL,oCAAQG,MAAR,GAAiB,KAAjB;AACAH,oCAAQI,IAAR,GAAe,MAAf;AACAJ,oCAAQJ,KAAR,GAAiBA,QAAQ,EAAT,GAAe,IAA/B;AACAI,oCAAQF,MAAR,GAAiB7B,KAAKC,KAAL,CAAW4B,SAAS,IAApB,IAA4B,IAA7C;AACH;;AAEDC,mCAAWQ,GAAX,CAAeP,OAAf;;AAEA,4BAAIQ,UAAU;AACVC,oCAAQ;AACJhF,sCAAM;AADF,6BADE;AAIVuB,oCAAQ;AACJ0D,uCAAO;AACHjF,0CAAM,IADH;AAEHkF,0CAAM,CAFH;AAGHC,+CAAW,CAHR;AAIHC,+CAAW,KAAK3I,KAAL,CAAWsD,SAAX,CAAqBqF;AAJ7B;AADH,6BAJE;AAYVC,mCAAO;AACHrF,sCAAM;AADH,6BAZG;AAeVsF,mCAAO;AACHtF,sCAAM,KADH;AAEHuF,sCAAM,MAFH;AAGHC,qCAAK,KAAK7I,IAAL,CAAUyE,KAAV,CAAgBC,IAAhB,CAAqBoE,OAArB,EAHF;AAIHxC,qCAAK,KAAKtG,IAAL,CAAUyE,KAAV,CAAgBE,EAAhB,CAAmBmE,OAAnB;AAJF,6BAfG;AAqBVC,kCAAM;AACFC,2CAAW,KADT;AAEF3F,sCAAM;AAFJ;AArBI,yBAAd;;AA2BA,6BAAKtD,IAAL,CAAUkJ,IAAV,CAAe,4CAAf,EAA6DC,MAA7D,CAAoEvB,UAApE;;AAEA,4BAAIwB,aAAa;AACb3G,kCAAM,KAAKA,IAAL,CAAU8C,SADH;AAEbnD,mCAAO,KAAKrC,KAAL,CAAWsD,SAAX,CAAqBgG;AAFf,yBAAjB;;AAKAhK,0BAAEiK,IAAF,CAAO1B,UAAP,EAAmB,CAACwB,UAAD,CAAnB,EAAiCf,OAAjC;AACH;;;sDAEiB;AACd,6BAAKkB,OAAL;AACH;;;yCAEIC,K,EAAOxJ,I,EAAMyJ,K,EAAOxJ,I,EAAM;AAC3B,6BAAKA,IAAL,GAAYA,IAAZ;AACA,6BAAKD,IAAL,GAAYA,IAAZ;;AAEA;AACA,4BAAI0J,mBAAmB1J,KAAKkJ,IAAL,CAAU,gBAAV,CAAvB;AACA,4BAAIQ,iBAAiBrF,MAArB,EACI,KAAKrE,IAAL,GAAY0J,gBAAZ;AACP;;;;cAhf8BvK,gB;;AAmfnCQ,iCAAqBgK,WAArB,GAAmC,aAAnC;;iCAGIhK,oB","file":"module.js","sourcesContent":["/*jshint esversion: 6 */\r\n/*jshint -W087 */\r\nimport {\r\n    MetricsPanelCtrl\r\n} from 'app/plugins/sdk';\r\n\r\nimport \"./css/annunciator-panel.css!\";\r\n\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport 'jquery.flot';\r\nimport angular from 'angular';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport config from 'app/core/config';\r\nimport TimeSeries from 'app/core/time_series2';\r\nimport {\r\n    appEvents\r\n} from 'app/core/core';\r\n\r\nclass AnnunciatorPanelCtrl extends MetricsPanelCtrl {\r\n\r\n    /** @ngInject */\r\n    constructor($scope, $injector) {\r\n        super($scope, $injector);\r\n\r\n        var panelDefaults = {\r\n            \"LowerLimit\": {\r\n                \"DisplayOption\": \"disabled\",\r\n                \"Color\": \"rgb(2, 17, 249)\",\r\n                \"Value\": 20,\r\n                \"Decimals\": 1,\r\n                \"FontSize\": \"50%\"\r\n            },\r\n            \"LowerWarning\": {\r\n                \"DisplayOption\": \"disabled\",\r\n                \"Color\": \"rgb(9, 115, 102)\",\r\n                \"Value\": 25\r\n            },\r\n            \"Metric\": {\r\n                \"Name\": \"current\",\r\n                \"Format\": \"percent\",\r\n                \"Color\": \"rgb(2, 247, 2)\",\r\n                \"Decimals\": 4,\r\n                \"FontSize\": \"100%\"\r\n            },\r\n            \"UpperWarning\": {\r\n                \"DisplayOption\": \"disabled\",\r\n                \"Color\": \"rgb(247, 2, 2)\",\r\n                \"Value\": 75\r\n            },\r\n            \"UpperLimit\": {\r\n                \"DisplayOption\": \"disabled\",\r\n                \"Color\": \"rgb(247, 90, 7)\",\r\n                \"Value\": 80,\r\n                \"Decimals\": 2,\r\n                \"FontSize\": \"50%\"\r\n            },\r\n            \"Prefix\": {\r\n                \"Text\": \"\",\r\n                \"FontSize\": \"hide\",\r\n            },\r\n            \"Postfix\": {\r\n                \"Text\": \"\",\r\n                \"FontSize\": \"hide\",\r\n            },\r\n            \"sparkline\": {\r\n                \"fillColor\": \"rgba(19, 193, 91, 0.32)\",\r\n                \"full\": false,\r\n                \"lineColor\": \"rgb(145, 200, 16)\",\r\n                \"show\": true\r\n            }\r\n        };\r\n\r\n        var panel = {};\r\n        var elem = {};\r\n        var ctrl = {};\r\n\r\n        _.defaults(this.panel, panelDefaults);\r\n\r\n        this.events.on('render', this.onRender.bind(this));\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n        this.events.on('data-error', this.onDataError.bind(this));\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    }\r\n\r\n    onDataError(err) {\r\n        appEvents.emit('alert-error', ['Annunciator Data Error', err]);\r\n        this.seriesList = [];\r\n        this.render([]);\r\n    }\r\n\r\n    onInitEditMode() {\r\n        this.metricNames = ['min', 'max', 'avg', 'current', 'total', 'first', 'delta', 'diff', 'range'];\r\n        this.fontSizes = ['20%', '30%', '50%', '70%', '80%', '100%', '110%', '120%', '150%', '170%', '200%'];\r\n        this.fontSizes0 = ['hide'].concat(this.fontSizes);\r\n        this.displayStates = ['disabled', 'static'];\r\n        this.displayStates1 = this.displayStates.concat(['flash', 'shock & awe']);\r\n        this.unitFormats = kbn.getUnitFormats();\r\n        this.addEditorTab('Options', 'public/plugins/michaeldmoore-annunciator-panel/options.html', 2);\r\n    }\r\n\r\n    setUnitFormat(subItem) {\r\n        this.panel.Metric.Format = subItem.value;\r\n        this.render();\r\n    }\r\n\r\n    getValueRegion(value) {\r\n        var valueRegion = \"OK\";\r\n\r\n        if (this.panel.UpperLimit.DisplayOption != 'disabled') {\r\n            if (value >= this.panel.UpperLimit.Value)\r\n                valueRegion = \"UpperLimit\";\r\n            else if (this.panel.UpperWarning.DisplayOption != 'disabled' && (value >= this.panel.UpperWarning.Value))\r\n                valueRegion = \"UpperWarning\";\r\n        }\r\n\r\n        if (this.panel.LowerLimit.DisplayOption != 'disabled') {\r\n            if (value <= this.panel.LowerLimit.Value)\r\n                valueRegion = \"LowerLimit\";\r\n            else if (this.panel.LowerWarning.DisplayOption != 'disabled' && (value <= this.panel.LowerWarning.Value))\r\n                valueRegion = \"LowerWarning\";\r\n        }\r\n\r\n        return valueRegion;\r\n    }\r\n\r\n    getDisplayAttributesForValue(value, metric) {\r\n        var displayAttributes = {};\r\n        var color = this.panel.Metric.Color;\r\n        var displayOption = this.panel.Metric.DisplayOption;\r\n        var flash = false;\r\n\r\n        var valueRegion = this.getValueRegion(this.data.value);\r\n        switch (valueRegion) {\r\n            case \"UpperLimit\":\r\n                color = this.panel.UpperLimit.Color;\r\n                displayOption = this.panel.UpperLimit.DisplayOption;\r\n                break;\r\n\r\n            case \"UpperWarning\":\r\n                color = this.panel.UpperWarning.Color;\r\n                displayOption = this.panel.UpperWarning.DisplayOption;\r\n                break;\r\n\r\n            case \"LowerWarning\":\r\n                color = this.panel.LowerWarning.Color;\r\n                displayOption = this.panel.LowerWarning.DisplayOption;\r\n                break;\r\n\r\n            case \"LowerLimit\":\r\n                color = this.panel.LowerLimit.Color;\r\n                displayOption = this.panel.LowerLimit.DisplayOption;\r\n                break;\r\n        }\r\n\r\n        switch (metric) {\r\n            case \"UpperLimit\":\r\n                color = this.panel.UpperLimit.Color;\r\n                if (displayOption == \"shock & awe\")\r\n                    displayOption = \"flash\";\r\n                if (valueRegion != \"UpperLimit\")\r\n                    displayOption = \"static\";\r\n                break;\r\n\r\n            case \"LowerLimit\":\r\n                color = this.panel.LowerLimit.Color;\r\n                if (displayOption == \"shock & awe\")\r\n                    displayOption = \"flash\";\r\n                if (valueRegion != \"LowerLimit\")\r\n                    displayOption = \"static\";\r\n                break;\r\n        }\r\n\r\n        displayAttributes.color = color;\r\n        displayAttributes.displayOption = displayOption;\r\n\r\n        return displayAttributes;\r\n    }\r\n\r\n    buildValueHtml() {\r\n        var html = '';\r\n\r\n        html += \"<div class='michaeldmoore-annunciator-panel-value-container'>\";\r\n        if (this.panel.Prefix.Text != '' && this.panel.Prefix.FontSize != 'hide')\r\n            html += this.getTextSpan('michaeldmoore-annunciator-panel-prefix', this.panel.Prefix.FontSize, this.panel.Prefix.Text, {});\r\n\r\n        html += this.getValueSpan('michaeldmoore-annunciator-panel-value', this.panel.Metric.FontSize, this.panel.Metric.Decimals, this.data.value, \"Value\");\r\n\r\n        if (this.panel.Postfix.Text != '' && this.panel.Postfix.FontSize != 'hide')\r\n            html += this.getTextSpan('michaeldmoore-annunciator-panel-postfix', this.panel.Postfix.FontSize, this.panel.Postfix.Text, {});\r\n\r\n        html += \"</div>\";\r\n\r\n        return html;\r\n    }\r\n\r\n    buildLimitsHtml() {\r\n        var html = '';\r\n\r\n        if (this.panel.UpperLimit.DisplayOption != 'disabled' || this.panel.LowerLimit.DisplayOption != 'disabled') {\r\n            html += \"<div class='michaeldmoore-annunciator-panel-limits-container'>\";\r\n\r\n            if (this.panel.LowerLimit.DisplayOption != 'disabled' && (this.panel.LowerLimit.FontSize != 'hide'))\r\n                html += this.getValueSpan('michaeldmoore-annunciator-panel-lower-limit', this.panel.LowerLimit.FontSize, this.panel.LowerLimit.Decimals, this.panel.LowerLimit.Value, \"LowerLimit\");\r\n\r\n            if (this.panel.UpperLimit.DisplayOption != 'disabled' && (this.panel.UpperLimit.FontSize != 'hide'))\r\n                html += this.getValueSpan('michaeldmoore-annunciator-panel-upper-limit', this.panel.UpperLimit.FontSize, this.panel.UpperLimit.Decimals, this.panel.UpperLimit.Value, \"UpperLimit\");\r\n\r\n            html += \"</div>\";\r\n\r\n            html += \"<div style='float:none;'/>\";\r\n        }\r\n        return html;\r\n    }\r\n\r\n    buildHtml() {\r\n        var html = \"<div class='michaeldmoore-annunciator-panel-container' style='height:100%;'>\";\r\n        if (this.data != null && this.data.value != null) {\r\n            html += this.buildLimitsHtml();\r\n            if ($.isNumeric(this.data.value))\r\n                html += this.buildValueHtml();\r\n            else\r\n                appEvents.emit('alert-warning', ['Annunciator Data Warning', 'Last data point is non-numeric']);\r\n        } else\r\n            html += '<div class=\"michaeldmoore-annunciator-panel-centered\">No data</div>';\r\n\r\n        html += \"</div>\";\r\n\r\n        this.elem.html(html);\r\n\r\n        if (this.panel.sparkline.show) {\r\n            this.addSparkline();\r\n        }\r\n    }\r\n\r\n    getTextSpan(className, fontSize, text, displayAttributes) {\r\n        var style = '';\r\n\r\n        if (fontSize)\r\n            style += \"font-size:\" + fontSize + \";\";\r\n\r\n        if (displayAttributes && displayAttributes.color)\r\n            style += \"color:\" + displayAttributes.color + \";\";\r\n\r\n        if (style)\r\n            style = ' style=\"' + style + '\"';\r\n\r\n        if (displayAttributes && displayAttributes.displayOption)\r\n            className += \" michaeldmoore-annunciator-\" + displayAttributes.displayOption.replace(' & ', 'and');\r\n\r\n        return '<span class=\"' + className + '\"' + style + '>' + text + '</span>';\r\n    }\r\n\r\n    getValueSpan(className, fontSize, decimals, value, metric) {\r\n        var displayAttributes = this.getDisplayAttributesForValue(value, metric);\r\n        return this.getTextSpan(className, fontSize, this.formatValue(value, decimals), displayAttributes);\r\n    }\r\n\r\n    setOKValueRange() {\r\n        var OKLowerLimit;\r\n        if (this.panel.LowerLimit.DisplayOption != 'disabled') {\r\n            if ($.isNumeric(this.panel.LowerLimit.Value)) {\r\n                if (this.panel.LowerWarning.DisplayOption != 'disabled') {\r\n                    if ($.isNumeric(this.panel.LowerWarning.Value))\r\n                        if (Number(this.panel.LowerWarning.Value) > Number(this.panel.LowerLimit.Value))\r\n                            OKLowerLimit = this.panel.LowerWarning.Value;\r\n                        else\r\n                            appEvents.emit('alert-warning', ['Annunciator Data Warning', 'LowerWarning Value should be greater than LowerLimit Value']);\r\n                    else\r\n                        appEvents.emit('alert-warning', ['Annunciator Data Warning', 'LowerWarning Value is non-numeric']);\r\n                } else\r\n                    OKLowerLimit = this.panel.LowerLimit.Value;\r\n            } else {\r\n                appEvents.emit('alert-warning', ['Annunciator Data Warning', 'LowerLimit Value is non-numeric']);\r\n            }\r\n        }\r\n\r\n        var OKUpperLimit;\r\n        if (this.panel.UpperLimit.DisplayOption != 'disabled') {\r\n            if ($.isNumeric(this.panel.UpperLimit.Value)) {\r\n                if (this.panel.UpperWarning.DisplayOption != 'disabled') {\r\n                    if ($.isNumeric(this.panel.UpperWarning.Value))\r\n                        if (Number(this.panel.UpperWarning.Value) < Number(this.panel.UpperLimit.Value))\r\n                            OKUpperLimit = this.panel.UpperWarning.Value;\r\n                        else\r\n                            appEvents.emit('alert-warning', ['Annunciator Data Warning', 'UpperWarning Value should be less than UpperLimit Value']);\r\n                    else\r\n                        appEvents.emit('alert-warning', ['Annunciator Data Warning', 'UpperWarning Value is non-numeric']);\r\n                } else\r\n                    OKUpperLimit = this.panel.UpperLimit.Value;\r\n            } else {\r\n                appEvents.emit('alert-warning', ['Annunciator Data Warning', 'UpperLimit Value is non-numeric']);\r\n            }\r\n        }\r\n\r\n        if ($.isNumeric(OKLowerLimit) && $.isNumeric(OKUpperLimit))\r\n            this.panel.MetricValueRange = OKLowerLimit + ' -> ' + OKUpperLimit;\r\n        else if ($.isNumeric(OKLowerLimit))\r\n            this.panel.MetricValueRange = '> ' + OKLowerLimit;\r\n        else if ($.isNumeric(OKUpperLimit))\r\n            this.panel.MetricValueRange = '< ' + OKUpperLimit;\r\n        else\r\n            this.panel.MetricValueRange = '';\r\n    }\r\n\r\n    onRender() {\r\n        var data = {};\r\n        if (this.dataList.length > 0) {\r\n            this.dataList[0].datapoints = this.dataPoints.filter(dp => dp[1] >= this.range.from && dp[1] <= this.range.to);\r\n            if (this.dataList[0].datapoints.length > 0) {\r\n                this.series = this.dataList.map(this.seriesHandler.bind(this));\r\n                this.setValues(data);\r\n            }\r\n        }\r\n\r\n        this.data = data;\r\n\r\n        this.buildHtml();\r\n        this.setOKValueRange();\r\n        this.ctrl.renderingCompleted();\r\n    }\r\n\r\n\r\n    onDataReceived(dataList) {\r\n        this.dataList = dataList;\r\n        if (dataList.length > 0) {\r\n            this.dataPoints = dataList[0].datapoints;\r\n        }\r\n        this.render();\r\n    }\r\n\r\n    seriesHandler(seriesData) {\r\n        var series = new TimeSeries({\r\n            datapoints: seriesData.datapoints,\r\n            alias: seriesData.target,\r\n        });\r\n\r\n        series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\r\n        return series;\r\n    }\r\n\r\n    getDecimalsForValue(value, decimals) {\r\n        if (_.isNumber(decimals)) {\r\n            return {\r\n                decimals: decimals,\r\n                scaledDecimals: null\r\n            };\r\n        }\r\n\r\n        var delta = value / 2;\r\n        var dec = -Math.floor(Math.log(delta) / Math.LN10);\r\n\r\n        var magn = Math.pow(10, -dec),\r\n            norm = delta / magn, // norm is between 1.0 and 10.0\r\n            size;\r\n\r\n        if (norm < 1.5) {\r\n            size = 1;\r\n        } else if (norm < 3) {\r\n            size = 2;\r\n            // special case for 2.5, requires an extra decimal\r\n            if (norm > 2.25) {\r\n                size = 2.5;\r\n                ++dec;\r\n            }\r\n        } else if (norm < 7.5) {\r\n            size = 5;\r\n        } else {\r\n            size = 10;\r\n        }\r\n\r\n        size *= magn;\r\n\r\n        // reduce starting decimals if not needed\r\n        if (Math.floor(value) === value) {\r\n            dec = 0;\r\n        }\r\n\r\n        var result = {};\r\n        result.decimals = Math.max(0, dec);\r\n        result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\r\n\r\n        return result;\r\n    }\r\n\r\n    formatValue(value, decimals) {\r\n        // crude work-around for kbn formatting function error - preserve decimal places even for whole numbers\r\n        //if (value == 0 && decimals > 0)\r\n        //    value += 0.000000000000001;\r\n        var decimalInfo = this.getDecimalsForValue(value, decimals);\r\n        var formatFunc = kbn.valueFormats[this.panel.Metric.Format];\r\n        return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\r\n    }\r\n\r\n    setValues(data) {\r\n        data.flotpairs = [];\r\n\r\n        if (this.series.length > 1) {\r\n            appEvents.emit('alert-error', ['Annunciator Multiple Series Error',\r\n                'Metric query returns ' + this.series.length + ' series. Annunciator Panel expects a single series.\\n\\nResponse:\\n' + JSON.stringify(this.series)\r\n            ]);\r\n        }\r\n\r\n        if (this.series && this.series.length > 0) {\r\n            var lastPoint = _.last(this.series[0].datapoints);\r\n            var lastValue = _.isArray(lastPoint) ? lastPoint[0] : null;\r\n\r\n            if (_.isString(lastValue)) {\r\n                data.value = 0;\r\n                data.valueFormatted = _.escape(lastValue);\r\n                data.valueRounded = 0;\r\n            } else {\r\n                data.value = this.series[0].stats[this.panel.Metric.Name];\r\n                data.flotpairs = this.series[0].flotpairs;\r\n\r\n                if (data == null || data.value == null) {\r\n                    data.value = 0.0;\r\n                }\r\n\r\n                var decimalInfo = this.getDecimalsForValue(data.value, this.panel.Metric.Decimals);\r\n                var formatFunc = kbn.valueFormats[this.panel.Metric.Format];\r\n                data.valueFormatted = formatFunc(data.value, decimalInfo.decimals, decimalInfo.scaledDecimals);\r\n                data.valueRounded = kbn.roundValue(data.value, decimalInfo.decimals);\r\n            }\r\n\r\n            if (data == null || data.value == null) {\r\n                data.value = 0.0;\r\n            }\r\n\r\n            // Add $__name variable for using in prefix or postfix\r\n            //data.scopedVars = _.extend({}, this.panel.scopedVars);\r\n            //data.scopedVars[\"__name\"] = {\r\n            //    value: this.series[0].label\r\n            //};\r\n        }\r\n    }\r\n\r\n    addSparkline() {\r\n        if (this.elem == null || this.elem.width() < 10) {\r\n            // element has not gotten it's width yet\r\n            // delay sparkline render\r\n            setTimeout(this.addSparkline, 30);\r\n            return;\r\n        }\r\n\r\n        var width = this.elem.width() + 20;\r\n        var height = this.elem.height();\r\n        var plotCanvas = $('<div></div>');\r\n        var plotCss = {};\r\n        plotCss.position = 'absolute';\r\n\r\n        if (this.panel.sparkline.full) {\r\n            plotCss.bottom = '5px';\r\n            plotCss.left = '-5px';\r\n            plotCss.width = (width - 10) + 'px';\r\n            var dynamicHeightMargin = height <= 100 ? 5 : (Math.round((height / 100)) * 15) + 5;\r\n            plotCss.height = (height - dynamicHeightMargin) + 'px';\r\n        } else {\r\n            plotCss.bottom = \"0px\";\r\n            plotCss.left = \"-5px\";\r\n            plotCss.width = (width - 10) + 'px';\r\n            plotCss.height = Math.floor(height * 0.25) + 'px';\r\n        }\r\n\r\n        plotCanvas.css(plotCss);\r\n\r\n        var options = {\r\n            legend: {\r\n                show: false\r\n            },\r\n            series: {\r\n                lines: {\r\n                    show: true,\r\n                    fill: 1,\r\n                    lineWidth: 1,\r\n                    fillColor: this.panel.sparkline.fillColor,\r\n                },\r\n            },\r\n            yaxes: {\r\n                show: false\r\n            },\r\n            xaxis: {\r\n                show: false,\r\n                mode: \"time\",\r\n                min: this.ctrl.range.from.valueOf(),\r\n                max: this.ctrl.range.to.valueOf(),\r\n            },\r\n            grid: {\r\n                hoverable: false,\r\n                show: false\r\n            },\r\n        };\r\n\r\n        this.elem.find('.michaeldmoore-annunciator-panel-container').append(plotCanvas);\r\n\r\n        var plotSeries = {\r\n            data: this.data.flotpairs,\r\n            color: this.panel.sparkline.lineColor\r\n        };\r\n\r\n        $.plot(plotCanvas, [plotSeries], options);\r\n    }\r\n\r\n    onConfigChanged() {\r\n        this.refresh();\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl) {\r\n        this.ctrl = ctrl;\r\n        this.elem = elem;\r\n\r\n        // for backward compatability (grafana 6.6.0 and earlier)\r\n        var panelContentElem = elem.find('.panel-content');\r\n        if (panelContentElem.length)\r\n            this.elem = panelContentElem;\r\n    }\r\n}\r\n\r\nAnnunciatorPanelCtrl.templateUrl = 'module.html';\r\n\r\nexport {\r\n    AnnunciatorPanelCtrl as PanelCtrl\r\n};"]}