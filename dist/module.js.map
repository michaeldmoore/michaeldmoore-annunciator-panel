{"version":3,"sources":["../src/module.js"],"names":["MetricsPanelCtrl","_","$","angular","kbn","config","TimeSeries","appEvents","AnnunciatorPanelCtrl","$scope","$injector","panelDefaults","panel","elem","ctrl","defaults","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","err","emit","seriesList","render","metricNames","fontSizes","fontSizes0","concat","displayStates","displayStates1","unitFormats","getUnitFormats","addEditorTab","subItem","Metric","Format","value","valueRegion","UpperLimit","DisplayOption","Value","UpperWarning","LowerLimit","LowerWarning","metric","displayAttributes","color","Color","displayOption","flash","getValueRegion","data","html","Prefix","Text","FontSize","getTextSpan","getValueSpan","Decimals","Postfix","buildLimitsHtml","isNumeric","buildValueHtml","sparkline","show","addSparkline","className","fontSize","text","style","replace","decimals","getDisplayAttributesForValue","formatValue","OKLowerLimit","Number","OKUpperLimit","MetricValueRange","dataList","length","datapoints","dataPoints","filter","dp","range","from","to","series","map","seriesHandler","setValues","buildHtml","setOKValueRange","renderingCompleted","seriesData","alias","target","flotpairs","getFlotPairs","nullPointMode","isNumber","scaledDecimals","delta","dec","Math","floor","log","LN10","magn","pow","norm","size","result","max","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","JSON","stringify","lastPoint","last","lastValue","isArray","isString","valueFormatted","escape","valueRounded","stats","Name","roundValue","width","setTimeout","height","plotCanvas","plotCss","position","full","bottom","left","dynamicHeightMargin","round","css","options","legend","lines","fill","lineWidth","fillColor","yaxes","xaxis","mode","min","valueOf","grid","hoverable","find","append","plotSeries","lineColor","plot","refresh","scope","attrs","panelContentElem","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGEA,sB,kBAAAA,gB;;AAKKC,O;;AACAC,O;;AAEAC,a;;AACAC,S;;AACAC,Y;;AACAC,gB;;AAELC,e,gBAAAA,S;;;;;;;;;;;;;;;;;;;;;2BAGIC,oB;;;AAEJ;AACA,sCAAYC,MAAZ,EAAoBC,SAApB,EAA+B;AAAA;;AAAA,kJACvBD,MADuB,EACfC,SADe;;AAG7B,cAAIC,gBAAgB;AAClB,0BAAc;AACZ,+BAAiB,UADL;AAEZ,uBAAS,iBAFG;AAGZ,uBAAS,EAHG;AAIZ,0BAAY,CAJA;AAKZ,0BAAY;AALA,aADI;AAQlB,4BAAgB;AACd,+BAAiB,UADH;AAEd,uBAAS,kBAFK;AAGd,uBAAS;AAHK,aARE;AAalB,sBAAU;AACR,sBAAQ,SADA;AAER,wBAAU,SAFF;AAGR,uBAAS,gBAHD;AAIR,0BAAY,CAJJ;AAKR,0BAAY;AALJ,aAbQ;AAoBlB,4BAAgB;AACd,+BAAiB,UADH;AAEd,uBAAS,gBAFK;AAGd,uBAAS;AAHK,aApBE;AAyBlB,0BAAc;AACZ,+BAAiB,UADL;AAEZ,uBAAS,iBAFG;AAGZ,uBAAS,EAHG;AAIZ,0BAAY,CAJA;AAKZ,0BAAY;AALA,aAzBI;AAgClB,sBAAU;AACR,sBAAQ,EADA;AAER,0BAAY;AAFJ,aAhCQ;AAoClB,uBAAW;AACT,sBAAQ,EADC;AAET,0BAAY;AAFH,aApCO;AAwClB,yBAAa;AACX,2BAAa,yBADF;AAEX,sBAAQ,KAFG;AAGX,2BAAa,mBAHF;AAIX,sBAAQ;AAJG;AAxCK,WAApB;;AAgDA,cAAIC,QAAQ,EAAZ;AACA,cAAIC,OAAO,EAAX;AACA,cAAIC,OAAO,EAAX;;AAEAb,YAAEc,QAAF,CAAW,MAAKH,KAAhB,EAAuBD,aAAvB;;AAEA,gBAAKK,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKC,QAAL,CAAcC,IAAd,OAAzB;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKG,cAAL,CAAoBD,IAApB,OAAhC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKI,WAAL,CAAiBF,IAAjB,OAA7B;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKK,cAAL,CAAoBH,IAApB,OAAjC;AA5D6B;AA6D9B;;;;sCAEWI,G,EAAK;AACfhB,sBAAUiB,IAAV,CAAe,aAAf,EAA8B,CAAC,wBAAD,EAA2BD,GAA3B,CAA9B;AACA,iBAAKE,UAAL,GAAkB,EAAlB;AACA,iBAAKC,MAAL,CAAY,EAAZ;AACD;;;2CAEgB;AACf,iBAAKC,WAAL,GAAmB,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,SAAtB,EAAiC,OAAjC,EAA0C,OAA1C,EAAmD,OAAnD,EAA4D,MAA5D,EAAoE,OAApE,CAAnB;AACA,iBAAKC,SAAL,GAAiB,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,KAAtB,EAA6B,KAA7B,EAAoC,MAApC,EAA4C,MAA5C,EAAoD,MAApD,EAA4D,MAA5D,EAAoE,MAApE,EAA4E,MAA5E,CAAjB;AACA,iBAAKC,UAAL,GAAkB,CAAC,MAAD,EAASC,MAAT,CAAgB,KAAKF,SAArB,CAAlB;AACA,iBAAKG,aAAL,GAAqB,CAAC,UAAD,EAAa,QAAb,CAArB;AACA,iBAAKC,cAAL,GAAsB,KAAKD,aAAL,CAAmBD,MAAnB,CAA0B,CAAC,OAAD,EAAU,aAAV,CAA1B,CAAtB;AACA,iBAAKG,WAAL,GAAmB7B,IAAI8B,cAAJ,EAAnB;AACA,iBAAKC,YAAL,CAAkB,SAAlB,EAA6B,6DAA7B,EAA4F,CAA5F;AACD;;;wCAEaC,O,EAAS;AACrB,iBAAKxB,KAAL,CAAWyB,MAAX,CAAkBC,MAAlB,GAA2BF,QAAQG,KAAnC;AACA,iBAAKb,MAAL;AACD;;;yCAEca,K,EAAO;AACpB,gBAAIC,cAAc,IAAlB;;AAEA,gBAAI,KAAK5B,KAAL,CAAW6B,UAAX,CAAsBC,aAAtB,IAAuC,UAA3C,EAAuD;AACrD,kBAAIH,SAAS,KAAK3B,KAAL,CAAW6B,UAAX,CAAsBE,KAAnC,EACEH,cAAc,YAAd,CADF,KAEK,IAAI,KAAK5B,KAAL,CAAWgC,YAAX,CAAwBF,aAAxB,IAAyC,UAAzC,IAAwDH,SAAS,KAAK3B,KAAL,CAAWgC,YAAX,CAAwBD,KAA7F,EACHH,cAAc,cAAd;AACH;;AAED,gBAAI,KAAK5B,KAAL,CAAWiC,UAAX,CAAsBH,aAAtB,IAAuC,UAA3C,EAAuD;AACrD,kBAAIH,SAAS,KAAK3B,KAAL,CAAWiC,UAAX,CAAsBF,KAAnC,EACEH,cAAc,YAAd,CADF,KAEK,IAAI,KAAK5B,KAAL,CAAWkC,YAAX,CAAwBJ,aAAxB,IAAyC,UAAzC,IAAwDH,SAAS,KAAK3B,KAAL,CAAWkC,YAAX,CAAwBH,KAA7F,EACHH,cAAc,cAAd;AACH;;AAED,mBAAOA,WAAP;AACD;;;uDAE4BD,K,EAAOQ,M,EAAQ;AAC1C,gBAAIC,oBAAoB,EAAxB;AACA,gBAAIC,QAAQ,KAAKrC,KAAL,CAAWyB,MAAX,CAAkBa,KAA9B;AACA,gBAAIC,gBAAgB,KAAKvC,KAAL,CAAWyB,MAAX,CAAkBK,aAAtC;AACA,gBAAIU,QAAQ,KAAZ;;AAEA,gBAAIZ,cAAc,KAAKa,cAAL,CAAoB,KAAKC,IAAL,CAAUf,KAA9B,CAAlB;AACA,oBAAQC,WAAR;AACE,mBAAK,YAAL;AACES,wBAAQ,KAAKrC,KAAL,CAAW6B,UAAX,CAAsBS,KAA9B;AACAC,gCAAgB,KAAKvC,KAAL,CAAW6B,UAAX,CAAsBC,aAAtC;AACA;;AAEF,mBAAK,cAAL;AACEO,wBAAQ,KAAKrC,KAAL,CAAWgC,YAAX,CAAwBM,KAAhC;AACAC,gCAAgB,KAAKvC,KAAL,CAAWgC,YAAX,CAAwBF,aAAxC;AACA;;AAEF,mBAAK,cAAL;AACEO,wBAAQ,KAAKrC,KAAL,CAAWkC,YAAX,CAAwBI,KAAhC;AACAC,gCAAgB,KAAKvC,KAAL,CAAWkC,YAAX,CAAwBJ,aAAxC;AACA;;AAEF,mBAAK,YAAL;AACEO,wBAAQ,KAAKrC,KAAL,CAAWiC,UAAX,CAAsBK,KAA9B;AACAC,gCAAgB,KAAKvC,KAAL,CAAWiC,UAAX,CAAsBH,aAAtC;AACA;AAnBJ;;AAsBA,oBAAQK,MAAR;AACE,mBAAK,YAAL;AACEE,wBAAQ,KAAKrC,KAAL,CAAW6B,UAAX,CAAsBS,KAA9B;AACA,oBAAIC,iBAAiB,aAArB,EACEA,gBAAgB,OAAhB;AACF,oBAAIX,eAAe,YAAnB,EACEW,gBAAgB,QAAhB;AACF;;AAEF,mBAAK,YAAL;AACEF,wBAAQ,KAAKrC,KAAL,CAAWiC,UAAX,CAAsBK,KAA9B;AACA,oBAAIC,iBAAiB,aAArB,EACEA,gBAAgB,OAAhB;AACF,oBAAIX,eAAe,YAAnB,EACEW,gBAAgB,QAAhB;AACF;AAfJ;;AAkBAH,8BAAkBC,KAAlB,GAA0BA,KAA1B;AACAD,8BAAkBG,aAAlB,GAAkCA,aAAlC;;AAEA,mBAAOH,iBAAP;AACD;;;2CAEgB;AACf,gBAAIO,OAAO,EAAX;;AAEAA,oBAAQ,+DAAR;AACA,gBAAI,KAAK3C,KAAL,CAAW4C,MAAX,CAAkBC,IAAlB,IAA0B,EAA1B,IAAgC,KAAK7C,KAAL,CAAW4C,MAAX,CAAkBE,QAAlB,IAA8B,MAAlE,EACEH,QAAQ,KAAKI,WAAL,CAAiB,wCAAjB,EAA2D,KAAK/C,KAAL,CAAW4C,MAAX,CAAkBE,QAA7E,EAAuF,KAAK9C,KAAL,CAAW4C,MAAX,CAAkBC,IAAzG,EAA+G,EAA/G,CAAR;;AAEFF,oBAAQ,KAAKK,YAAL,CAAkB,uCAAlB,EAA2D,KAAKhD,KAAL,CAAWyB,MAAX,CAAkBqB,QAA7E,EAAuF,KAAK9C,KAAL,CAAWyB,MAAX,CAAkBwB,QAAzG,EAAmH,KAAKP,IAAL,CAAUf,KAA7H,EAAoI,OAApI,CAAR;;AAEA,gBAAI,KAAK3B,KAAL,CAAWkD,OAAX,CAAmBL,IAAnB,IAA2B,EAA3B,IAAiC,KAAK7C,KAAL,CAAWkD,OAAX,CAAmBJ,QAAnB,IAA+B,MAApE,EACEH,QAAQ,KAAKI,WAAL,CAAiB,yCAAjB,EAA4D,KAAK/C,KAAL,CAAWkD,OAAX,CAAmBJ,QAA/E,EAAyF,KAAK9C,KAAL,CAAWkD,OAAX,CAAmBL,IAA5G,EAAkH,EAAlH,CAAR;;AAEFF,oBAAQ,QAAR;;AAEA,mBAAOA,IAAP;AACD;;;4CAEiB;AAChB,gBAAIA,OAAO,EAAX;;AAEA,gBAAI,KAAK3C,KAAL,CAAW6B,UAAX,CAAsBC,aAAtB,IAAuC,UAAvC,IAAqD,KAAK9B,KAAL,CAAWiC,UAAX,CAAsBH,aAAtB,IAAuC,UAAhG,EAA4G;AAC1Ga,sBAAQ,gEAAR;;AAEA,kBAAI,KAAK3C,KAAL,CAAWiC,UAAX,CAAsBH,aAAtB,IAAuC,UAAvC,IAAsD,KAAK9B,KAAL,CAAWiC,UAAX,CAAsBa,QAAtB,IAAkC,MAA5F,EACEH,QAAQ,KAAKK,YAAL,CAAkB,6CAAlB,EAAiE,KAAKhD,KAAL,CAAWiC,UAAX,CAAsBa,QAAvF,EAAiG,KAAK9C,KAAL,CAAWiC,UAAX,CAAsBgB,QAAvH,EAAiI,KAAKjD,KAAL,CAAWiC,UAAX,CAAsBF,KAAvJ,EAA8J,YAA9J,CAAR;;AAEF,kBAAI,KAAK/B,KAAL,CAAW6B,UAAX,CAAsBC,aAAtB,IAAuC,UAAvC,IAAsD,KAAK9B,KAAL,CAAW6B,UAAX,CAAsBiB,QAAtB,IAAkC,MAA5F,EACEH,QAAQ,KAAKK,YAAL,CAAkB,6CAAlB,EAAiE,KAAKhD,KAAL,CAAW6B,UAAX,CAAsBiB,QAAvF,EAAiG,KAAK9C,KAAL,CAAW6B,UAAX,CAAsBoB,QAAvH,EAAiI,KAAKjD,KAAL,CAAW6B,UAAX,CAAsBE,KAAvJ,EAA8J,YAA9J,CAAR;;AAEFY,sBAAQ,QAAR;;AAEAA,sBAAQ,4BAAR;AACD;AACD,mBAAOA,IAAP;AACD;;;sCAEW;AACV,gBAAIA,OAAO,8EAAX;AACA,gBAAI,KAAKD,IAAL,IAAa,IAAb,IAAqB,KAAKA,IAAL,CAAUf,KAAV,IAAmB,IAA5C,EAAkD;AAChDgB,sBAAQ,KAAKQ,eAAL,EAAR;AACA,kBAAI7D,EAAE8D,SAAF,CAAY,KAAKV,IAAL,CAAUf,KAAtB,CAAJ,EACEgB,QAAQ,KAAKU,cAAL,EAAR,CADF,KAGE1D,UAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,gCAA7B,CAAhC;AACH,aAND,MAOE+B,QAAQ,qEAAR;;AAEFA,oBAAQ,QAAR;;AAEA,iBAAK1C,IAAL,CAAU0C,IAAV,CAAeA,IAAf;;AAEA,gBAAI,KAAK3C,KAAL,CAAWsD,SAAX,CAAqBC,IAAzB,EAA+B;AAC7B,mBAAKC,YAAL;AACD;AACF;;;sCAEWC,S,EAAWC,Q,EAAUC,I,EAAMvB,iB,EAAmB;AACxD,gBAAIwB,QAAQ,EAAZ;;AAEA,gBAAIF,QAAJ,EACEE,SAAS,eAAeF,QAAf,GAA0B,GAAnC;;AAEF,gBAAItB,qBAAqBA,kBAAkBC,KAA3C,EACEuB,SAAS,WAAWxB,kBAAkBC,KAA7B,GAAqC,GAA9C;;AAEF,gBAAIuB,KAAJ,EACEA,QAAQ,aAAaA,KAAb,GAAqB,GAA7B;;AAEF,gBAAIxB,qBAAqBA,kBAAkBG,aAA3C,EACEkB,aAAa,gCAAgCrB,kBAAkBG,aAAlB,CAAgCsB,OAAhC,CAAwC,KAAxC,EAA+C,KAA/C,CAA7C;;AAEF,mBAAO,kBAAkBJ,SAAlB,GAA8B,GAA9B,GAAoCG,KAApC,GAA4C,GAA5C,GAAkDD,IAAlD,GAAyD,SAAhE;AACD;;;uCAEYF,S,EAAWC,Q,EAAUI,Q,EAAUnC,K,EAAOQ,M,EAAQ;AACzD,gBAAIC,oBAAoB,KAAK2B,4BAAL,CAAkCpC,KAAlC,EAAyCQ,MAAzC,CAAxB;AACA,mBAAO,KAAKY,WAAL,CAAiBU,SAAjB,EAA4BC,QAA5B,EAAsC,KAAKM,WAAL,CAAiBrC,KAAjB,EAAwBmC,QAAxB,CAAtC,EAAyE1B,iBAAzE,CAAP;AACD;;;4CAEiB;AAChB,gBAAI6B,YAAJ;AACA,gBAAI,KAAKjE,KAAL,CAAWiC,UAAX,CAAsBH,aAAtB,IAAuC,UAA3C,EAAuD;AACrD,kBAAIxC,EAAE8D,SAAF,CAAY,KAAKpD,KAAL,CAAWiC,UAAX,CAAsBF,KAAlC,CAAJ,EAA8C;AAC5C,oBAAI,KAAK/B,KAAL,CAAWkC,YAAX,CAAwBJ,aAAxB,IAAyC,UAA7C,EAAyD;AACvD,sBAAIxC,EAAE8D,SAAF,CAAY,KAAKpD,KAAL,CAAWkC,YAAX,CAAwBH,KAApC,CAAJ;AACE,wBAAImC,OAAO,KAAKlE,KAAL,CAAWkC,YAAX,CAAwBH,KAA/B,IAAwCmC,OAAO,KAAKlE,KAAL,CAAWiC,UAAX,CAAsBF,KAA7B,CAA5C,EACEkC,eAAe,KAAKjE,KAAL,CAAWkC,YAAX,CAAwBH,KAAvC,CADF,KAGEpC,UAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,4DAA7B,CAAhC;AAJJ,yBAMEjB,UAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,mCAA7B,CAAhC;AACH,iBARD,MASEqD,eAAe,KAAKjE,KAAL,CAAWiC,UAAX,CAAsBF,KAArC;AACH,eAXD,MAWO;AACLpC,0BAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,iCAA7B,CAAhC;AACD;AACF;;AAED,gBAAIuD,YAAJ;AACA,gBAAI,KAAKnE,KAAL,CAAW6B,UAAX,CAAsBC,aAAtB,IAAuC,UAA3C,EAAuD;AACrD,kBAAIxC,EAAE8D,SAAF,CAAY,KAAKpD,KAAL,CAAW6B,UAAX,CAAsBE,KAAlC,CAAJ,EAA8C;AAC5C,oBAAI,KAAK/B,KAAL,CAAWgC,YAAX,CAAwBF,aAAxB,IAAyC,UAA7C,EAAyD;AACvD,sBAAIxC,EAAE8D,SAAF,CAAY,KAAKpD,KAAL,CAAWgC,YAAX,CAAwBD,KAApC,CAAJ;AACE,wBAAImC,OAAO,KAAKlE,KAAL,CAAWgC,YAAX,CAAwBD,KAA/B,IAAwCmC,OAAO,KAAKlE,KAAL,CAAW6B,UAAX,CAAsBE,KAA7B,CAA5C,EACEoC,eAAe,KAAKnE,KAAL,CAAWgC,YAAX,CAAwBD,KAAvC,CADF,KAGEpC,UAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,yDAA7B,CAAhC;AAJJ,yBAMEjB,UAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,mCAA7B,CAAhC;AACH,iBARD,MASEuD,eAAe,KAAKnE,KAAL,CAAW6B,UAAX,CAAsBE,KAArC;AACH,eAXD,MAWO;AACLpC,0BAAUiB,IAAV,CAAe,eAAf,EAAgC,CAAC,0BAAD,EAA6B,iCAA7B,CAAhC;AACD;AACF;;AAED,gBAAItB,EAAE8D,SAAF,CAAYa,YAAZ,KAA6B3E,EAAE8D,SAAF,CAAYe,YAAZ,CAAjC,EACE,KAAKnE,KAAL,CAAWoE,gBAAX,GAA8BH,eAAe,MAAf,GAAwBE,YAAtD,CADF,KAEK,IAAI7E,EAAE8D,SAAF,CAAYa,YAAZ,CAAJ,EACH,KAAKjE,KAAL,CAAWoE,gBAAX,GAA8B,OAAOH,YAArC,CADG,KAEA,IAAI3E,EAAE8D,SAAF,CAAYe,YAAZ,CAAJ,EACH,KAAKnE,KAAL,CAAWoE,gBAAX,GAA8B,OAAOD,YAArC,CADG,KAGH,KAAKnE,KAAL,CAAWoE,gBAAX,GAA8B,EAA9B;AACH;;;qCAEU;AAAA;;AACT,gBAAI1B,OAAO,EAAX;AACA,gBAAI,KAAK2B,QAAL,CAAcC,MAAd,GAAuB,CAA3B,EAA8B;AAC5B,mBAAKD,QAAL,CAAc,CAAd,EAAiBE,UAAjB,GAA8B,KAAKC,UAAL,CAAgBC,MAAhB,CAAuB;AAAA,uBAAMC,GAAG,CAAH,KAAS,OAAKC,KAAL,CAAWC,IAApB,IAA4BF,GAAG,CAAH,KAAS,OAAKC,KAAL,CAAWE,EAAtD;AAAA,eAAvB,CAA9B;AACA,kBAAI,KAAKR,QAAL,CAAc,CAAd,EAAiBE,UAAjB,CAA4BD,MAA5B,GAAqC,CAAzC,EAA4C;AAC1C,qBAAKQ,MAAL,GAAc,KAAKT,QAAL,CAAcU,GAAd,CAAkB,KAAKC,aAAL,CAAmBzE,IAAnB,CAAwB,IAAxB,CAAlB,CAAd;AACA,qBAAK0E,SAAL,CAAevC,IAAf;AACD;AACF;;AAED,iBAAKA,IAAL,GAAYA,IAAZ;;AAEA,iBAAKwC,SAAL;AACA,iBAAKC,eAAL;AACA,iBAAKjF,IAAL,CAAUkF,kBAAV;AACD;;;yCAGcf,Q,EAAU;AACvB,iBAAKA,QAAL,GAAgBA,QAAhB;AACA,gBAAIA,SAASC,MAAT,GAAkB,CAAtB,EAAyB;AACvB,mBAAKE,UAAL,GAAkBH,SAAS,CAAT,EAAYE,UAA9B;AACD;AACD,iBAAKzD,MAAL;AACD;;;wCAEauE,U,EAAY;AACxB,gBAAIP,SAAS,IAAIpF,UAAJ,CAAe;AAC1B6E,0BAAYc,WAAWd,UADG;AAE1Be,qBAAOD,WAAWE;AAFQ,aAAf,CAAb;;AAKAT,mBAAOU,SAAP,GAAmBV,OAAOW,YAAP,CAAoB,KAAKzF,KAAL,CAAW0F,aAA/B,CAAnB;AACA,mBAAOZ,MAAP;AACD;;;8CAEmBnD,K,EAAOmC,Q,EAAU;AACnC,gBAAIzE,EAAEsG,QAAF,CAAW7B,QAAX,CAAJ,EAA0B;AACxB,qBAAO;AACLA,0BAAUA,QADL;AAEL8B,gCAAgB;AAFX,eAAP;AAID;;AAED,gBAAIC,QAAQlE,QAAQ,CAApB;AACA,gBAAImE,MAAM,CAACC,KAAKC,KAAL,CAAWD,KAAKE,GAAL,CAASJ,KAAT,IAAkBE,KAAKG,IAAlC,CAAX;;AAEA,gBAAIC,OAAOJ,KAAKK,GAAL,CAAS,EAAT,EAAa,CAACN,GAAd,CAAX;AAAA,gBACEO,OAAOR,QAAQM,IADjB;AAAA,gBACuB;AACrBG,gBAFF;;AAIA,gBAAID,OAAO,GAAX,EAAgB;AACdC,qBAAO,CAAP;AACD,aAFD,MAEO,IAAID,OAAO,CAAX,EAAc;AACnBC,qBAAO,CAAP;AACA;AACA,kBAAID,OAAO,IAAX,EAAiB;AACfC,uBAAO,GAAP;AACA,kBAAER,GAAF;AACD;AACF,aAPM,MAOA,IAAIO,OAAO,GAAX,EAAgB;AACrBC,qBAAO,CAAP;AACD,aAFM,MAEA;AACLA,qBAAO,EAAP;AACD;;AAEDA,oBAAQH,IAAR;;AAEA;AACA,gBAAIJ,KAAKC,KAAL,CAAWrE,KAAX,MAAsBA,KAA1B,EAAiC;AAC/BmE,oBAAM,CAAN;AACD;;AAED,gBAAIS,SAAS,EAAb;AACAA,mBAAOzC,QAAP,GAAkBiC,KAAKS,GAAL,CAAS,CAAT,EAAYV,GAAZ,CAAlB;AACAS,mBAAOX,cAAP,GAAwBW,OAAOzC,QAAP,GAAkBiC,KAAKC,KAAL,CAAWD,KAAKE,GAAL,CAASK,IAAT,IAAiBP,KAAKG,IAAjC,CAAlB,GAA2D,CAAnF;;AAEA,mBAAOK,MAAP;AACD;;;sCAEW5E,K,EAAOmC,Q,EAAU;AAC3B;AACA;AACA;AACA,gBAAI2C,cAAc,KAAKC,mBAAL,CAAyB/E,KAAzB,EAAgCmC,QAAhC,CAAlB;AACA,gBAAI6C,aAAanH,IAAIoH,YAAJ,CAAiB,KAAK5G,KAAL,CAAWyB,MAAX,CAAkBC,MAAnC,CAAjB;AACA,mBAAOiF,WAAWhF,KAAX,EAAkB8E,YAAY3C,QAA9B,EAAwC2C,YAAYb,cAApD,CAAP;AACD;;;oCAESlD,I,EAAM;AACdA,iBAAK8C,SAAL,GAAiB,EAAjB;;AAEA,gBAAI,KAAKV,MAAL,CAAYR,MAAZ,GAAqB,CAAzB,EAA4B;AAC1B3E,wBAAUiB,IAAV,CAAe,aAAf,EAA8B,CAAC,mCAAD,EAC5B,0BAA0B,KAAKkE,MAAL,CAAYR,MAAtC,GAA+C,oEAA/C,GAAsHuC,KAAKC,SAAL,CAAe,KAAKhC,MAApB,CAD1F,CAA9B;AAGD;;AAED,gBAAI,KAAKA,MAAL,IAAe,KAAKA,MAAL,CAAYR,MAAZ,GAAqB,CAAxC,EAA2C;AACzC,kBAAIyC,YAAY1H,EAAE2H,IAAF,CAAO,KAAKlC,MAAL,CAAY,CAAZ,EAAeP,UAAtB,CAAhB;AACA,kBAAI0C,YAAY5H,EAAE6H,OAAF,CAAUH,SAAV,IAAuBA,UAAU,CAAV,CAAvB,GAAsC,IAAtD;;AAEA,kBAAI1H,EAAE8H,QAAF,CAAWF,SAAX,CAAJ,EAA2B;AACzBvE,qBAAKf,KAAL,GAAa,CAAb;AACAe,qBAAK0E,cAAL,GAAsB/H,EAAEgI,MAAF,CAASJ,SAAT,CAAtB;AACAvE,qBAAK4E,YAAL,GAAoB,CAApB;AACD,eAJD,MAIO;AACL5E,qBAAKf,KAAL,GAAa,KAAKmD,MAAL,CAAY,CAAZ,EAAeyC,KAAf,CAAqB,KAAKvH,KAAL,CAAWyB,MAAX,CAAkB+F,IAAvC,CAAb;AACA9E,qBAAK8C,SAAL,GAAiB,KAAKV,MAAL,CAAY,CAAZ,EAAeU,SAAhC;;AAEA,oBAAI9C,QAAQ,IAAR,IAAgBA,KAAKf,KAAL,IAAc,IAAlC,EAAwC;AACtCe,uBAAKf,KAAL,GAAa,GAAb;AACD;;AAED,oBAAI8E,cAAc,KAAKC,mBAAL,CAAyBhE,KAAKf,KAA9B,EAAqC,KAAK3B,KAAL,CAAWyB,MAAX,CAAkBwB,QAAvD,CAAlB;AACA,oBAAI0D,aAAanH,IAAIoH,YAAJ,CAAiB,KAAK5G,KAAL,CAAWyB,MAAX,CAAkBC,MAAnC,CAAjB;AACAgB,qBAAK0E,cAAL,GAAsBT,WAAWjE,KAAKf,KAAhB,EAAuB8E,YAAY3C,QAAnC,EAA6C2C,YAAYb,cAAzD,CAAtB;AACAlD,qBAAK4E,YAAL,GAAoB9H,IAAIiI,UAAJ,CAAe/E,KAAKf,KAApB,EAA2B8E,YAAY3C,QAAvC,CAApB;AACD;;AAED,kBAAIpB,QAAQ,IAAR,IAAgBA,KAAKf,KAAL,IAAc,IAAlC,EAAwC;AACtCe,qBAAKf,KAAL,GAAa,GAAb;AACD;;AAED;AACA;AACA;AACA;AACA;AACD;AACF;;;yCAEc;AACb,gBAAI,KAAK1B,IAAL,IAAa,IAAb,IAAqB,KAAKA,IAAL,CAAUyH,KAAV,KAAoB,EAA7C,EAAiD;AAC/C;AACA;AACAC,yBAAW,KAAKnE,YAAhB,EAA8B,EAA9B;AACA;AACD;;AAED,gBAAIkE,QAAQ,KAAKzH,IAAL,CAAUyH,KAAV,KAAoB,EAAhC;AACA,gBAAIE,SAAS,KAAK3H,IAAL,CAAU2H,MAAV,EAAb;AACA,gBAAIC,aAAavI,EAAE,aAAF,CAAjB;AACA,gBAAIwI,UAAU,EAAd;AACAA,oBAAQC,QAAR,GAAmB,UAAnB;;AAEA,gBAAI,KAAK/H,KAAL,CAAWsD,SAAX,CAAqB0E,IAAzB,EAA+B;AAC7BF,sBAAQG,MAAR,GAAiB,KAAjB;AACAH,sBAAQI,IAAR,GAAe,MAAf;AACAJ,sBAAQJ,KAAR,GAAiBA,QAAQ,EAAT,GAAe,IAA/B;AACA,kBAAIS,sBAAsBP,UAAU,GAAV,GAAgB,CAAhB,GAAqB7B,KAAKqC,KAAL,CAAYR,SAAS,GAArB,IAA6B,EAA9B,GAAoC,CAAlF;AACAE,sBAAQF,MAAR,GAAkBA,SAASO,mBAAV,GAAiC,IAAlD;AACD,aAND,MAMO;AACLL,sBAAQG,MAAR,GAAiB,KAAjB;AACAH,sBAAQI,IAAR,GAAe,MAAf;AACAJ,sBAAQJ,KAAR,GAAiBA,QAAQ,EAAT,GAAe,IAA/B;AACAI,sBAAQF,MAAR,GAAiB7B,KAAKC,KAAL,CAAW4B,SAAS,IAApB,IAA4B,IAA7C;AACD;;AAEDC,uBAAWQ,GAAX,CAAeP,OAAf;;AAEA,gBAAIQ,UAAU;AACZC,sBAAQ;AACNhF,sBAAM;AADA,eADI;AAIZuB,sBAAQ;AACN0D,uBAAO;AACLjF,wBAAM,IADD;AAELkF,wBAAM,CAFD;AAGLC,6BAAW,CAHN;AAILC,6BAAW,KAAK3I,KAAL,CAAWsD,SAAX,CAAqBqF;AAJ3B;AADD,eAJI;AAYZC,qBAAO;AACLrF,sBAAM;AADD,eAZK;AAeZsF,qBAAO;AACLtF,sBAAM,KADD;AAELuF,sBAAM,MAFD;AAGLC,qBAAK,KAAK7I,IAAL,CAAUyE,KAAV,CAAgBC,IAAhB,CAAqBoE,OAArB,EAHA;AAILxC,qBAAK,KAAKtG,IAAL,CAAUyE,KAAV,CAAgBE,EAAhB,CAAmBmE,OAAnB;AAJA,eAfK;AAqBZC,oBAAM;AACJC,2BAAW,KADP;AAEJ3F,sBAAM;AAFF;AArBM,aAAd;;AA2BA,iBAAKtD,IAAL,CAAUkJ,IAAV,CAAe,4CAAf,EAA6DC,MAA7D,CAAoEvB,UAApE;;AAEA,gBAAIwB,aAAa;AACf3G,oBAAM,KAAKA,IAAL,CAAU8C,SADD;AAEfnD,qBAAO,KAAKrC,KAAL,CAAWsD,SAAX,CAAqBgG;AAFb,aAAjB;;AAKAhK,cAAEiK,IAAF,CAAO1B,UAAP,EAAmB,CAACwB,UAAD,CAAnB,EAAiCf,OAAjC;AACD;;;4CAEiB;AAChB,iBAAKkB,OAAL;AACD;;;+BAEIC,K,EAAOxJ,I,EAAMyJ,K,EAAOxJ,I,EAAM;AAC7B,iBAAKA,IAAL,GAAYA,IAAZ;AACA,iBAAKD,IAAL,GAAYA,IAAZ;;AAEA;AACA,gBAAI0J,mBAAmB1J,KAAKkJ,IAAL,CAAU,gBAAV,CAAvB;AACA,gBAAIQ,iBAAiBrF,MAArB,EACE,KAAKrE,IAAL,GAAY0J,gBAAZ;AACH;;;;QAhfgCvK,gB;;AAmfnCQ,2BAAqBgK,WAArB,GAAmC,aAAnC;;2BAGEhK,oB","file":"module.js","sourcesContent":["/*jshint esversion: 6 */\r\n/*jshint -W087 */\r\nimport {\r\n  MetricsPanelCtrl\r\n} from 'app/plugins/sdk';\r\n\r\nimport \"./css/annunciator-panel.css!\";\r\n\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport 'jquery.flot';\r\nimport angular from 'angular';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport config from 'app/core/config';\r\nimport TimeSeries from 'app/core/time_series2';\r\nimport {\r\n  appEvents\r\n} from 'app/core/core';\r\n\r\nclass AnnunciatorPanelCtrl extends MetricsPanelCtrl {\r\n\r\n  /** @ngInject */\r\n  constructor($scope, $injector) {\r\n    super($scope, $injector);\r\n\r\n    var panelDefaults = {\r\n      \"LowerLimit\": {\r\n        \"DisplayOption\": \"disabled\",\r\n        \"Color\": \"rgb(2, 17, 249)\",\r\n        \"Value\": 20,\r\n        \"Decimals\": 1,\r\n        \"FontSize\": \"50%\"\r\n      },\r\n      \"LowerWarning\": {\r\n        \"DisplayOption\": \"disabled\",\r\n        \"Color\": \"rgb(9, 115, 102)\",\r\n        \"Value\": 25\r\n      },\r\n      \"Metric\": {\r\n        \"Name\": \"current\",\r\n        \"Format\": \"percent\",\r\n        \"Color\": \"rgb(2, 247, 2)\",\r\n        \"Decimals\": 4,\r\n        \"FontSize\": \"100%\"\r\n      },\r\n      \"UpperWarning\": {\r\n        \"DisplayOption\": \"disabled\",\r\n        \"Color\": \"rgb(247, 2, 2)\",\r\n        \"Value\": 75\r\n      },\r\n      \"UpperLimit\": {\r\n        \"DisplayOption\": \"disabled\",\r\n        \"Color\": \"rgb(247, 90, 7)\",\r\n        \"Value\": 80,\r\n        \"Decimals\": 2,\r\n        \"FontSize\": \"50%\"\r\n      },\r\n      \"Prefix\": {\r\n        \"Text\": \"\",\r\n        \"FontSize\": \"hide\",\r\n      },\r\n      \"Postfix\": {\r\n        \"Text\": \"\",\r\n        \"FontSize\": \"hide\",\r\n      },\r\n      \"sparkline\": {\r\n        \"fillColor\": \"rgba(19, 193, 91, 0.32)\",\r\n        \"full\": false,\r\n        \"lineColor\": \"rgb(145, 200, 16)\",\r\n        \"show\": true\r\n      }\r\n    };\r\n\r\n    var panel = {};\r\n    var elem = {};\r\n    var ctrl = {};\r\n\r\n    _.defaults(this.panel, panelDefaults);\r\n\r\n    this.events.on('render', this.onRender.bind(this));\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('data-error', this.onDataError.bind(this));\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n  }\r\n\r\n  onDataError(err) {\r\n    appEvents.emit('alert-error', ['Annunciator Data Error', err]);\r\n    this.seriesList = [];\r\n    this.render([]);\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.metricNames = ['min', 'max', 'avg', 'current', 'total', 'first', 'delta', 'diff', 'range'];\r\n    this.fontSizes = ['20%', '30%', '50%', '70%', '80%', '100%', '110%', '120%', '150%', '170%', '200%'];\r\n    this.fontSizes0 = ['hide'].concat(this.fontSizes);\r\n    this.displayStates = ['disabled', 'static'];\r\n    this.displayStates1 = this.displayStates.concat(['flash', 'shock & awe']);\r\n    this.unitFormats = kbn.getUnitFormats();\r\n    this.addEditorTab('Options', 'public/plugins/michaeldmoore-annunciator-panel/options.html', 2);\r\n  }\r\n\r\n  setUnitFormat(subItem) {\r\n    this.panel.Metric.Format = subItem.value;\r\n    this.render();\r\n  }\r\n\r\n  getValueRegion(value) {\r\n    var valueRegion = \"OK\";\r\n\r\n    if (this.panel.UpperLimit.DisplayOption != 'disabled') {\r\n      if (value >= this.panel.UpperLimit.Value)\r\n        valueRegion = \"UpperLimit\";\r\n      else if (this.panel.UpperWarning.DisplayOption != 'disabled' && (value >= this.panel.UpperWarning.Value))\r\n        valueRegion = \"UpperWarning\";\r\n    }\r\n\r\n    if (this.panel.LowerLimit.DisplayOption != 'disabled') {\r\n      if (value <= this.panel.LowerLimit.Value)\r\n        valueRegion = \"LowerLimit\";\r\n      else if (this.panel.LowerWarning.DisplayOption != 'disabled' && (value <= this.panel.LowerWarning.Value))\r\n        valueRegion = \"LowerWarning\";\r\n    }\r\n\r\n    return valueRegion;\r\n  }\r\n\r\n  getDisplayAttributesForValue(value, metric) {\r\n    var displayAttributes = {};\r\n    var color = this.panel.Metric.Color;\r\n    var displayOption = this.panel.Metric.DisplayOption;\r\n    var flash = false;\r\n\r\n    var valueRegion = this.getValueRegion(this.data.value);\r\n    switch (valueRegion) {\r\n      case \"UpperLimit\":\r\n        color = this.panel.UpperLimit.Color;\r\n        displayOption = this.panel.UpperLimit.DisplayOption;\r\n        break;\r\n\r\n      case \"UpperWarning\":\r\n        color = this.panel.UpperWarning.Color;\r\n        displayOption = this.panel.UpperWarning.DisplayOption;\r\n        break;\r\n\r\n      case \"LowerWarning\":\r\n        color = this.panel.LowerWarning.Color;\r\n        displayOption = this.panel.LowerWarning.DisplayOption;\r\n        break;\r\n\r\n      case \"LowerLimit\":\r\n        color = this.panel.LowerLimit.Color;\r\n        displayOption = this.panel.LowerLimit.DisplayOption;\r\n        break;\r\n    }\r\n\r\n    switch (metric) {\r\n      case \"UpperLimit\":\r\n        color = this.panel.UpperLimit.Color;\r\n        if (displayOption == \"shock & awe\")\r\n          displayOption = \"flash\";\r\n        if (valueRegion != \"UpperLimit\")\r\n          displayOption = \"static\";\r\n        break;\r\n\r\n      case \"LowerLimit\":\r\n        color = this.panel.LowerLimit.Color;\r\n        if (displayOption == \"shock & awe\")\r\n          displayOption = \"flash\";\r\n        if (valueRegion != \"LowerLimit\")\r\n          displayOption = \"static\";\r\n        break;\r\n    }\r\n\r\n    displayAttributes.color = color;\r\n    displayAttributes.displayOption = displayOption;\r\n\r\n    return displayAttributes;\r\n  }\r\n\r\n  buildValueHtml() {\r\n    var html = '';\r\n\r\n    html += \"<div class='michaeldmoore-annunciator-panel-value-container'>\";\r\n    if (this.panel.Prefix.Text != '' && this.panel.Prefix.FontSize != 'hide')\r\n      html += this.getTextSpan('michaeldmoore-annunciator-panel-prefix', this.panel.Prefix.FontSize, this.panel.Prefix.Text, {});\r\n\r\n    html += this.getValueSpan('michaeldmoore-annunciator-panel-value', this.panel.Metric.FontSize, this.panel.Metric.Decimals, this.data.value, \"Value\");\r\n\r\n    if (this.panel.Postfix.Text != '' && this.panel.Postfix.FontSize != 'hide')\r\n      html += this.getTextSpan('michaeldmoore-annunciator-panel-postfix', this.panel.Postfix.FontSize, this.panel.Postfix.Text, {});\r\n\r\n    html += \"</div>\";\r\n\r\n    return html;\r\n  }\r\n\r\n  buildLimitsHtml() {\r\n    var html = '';\r\n\r\n    if (this.panel.UpperLimit.DisplayOption != 'disabled' || this.panel.LowerLimit.DisplayOption != 'disabled') {\r\n      html += \"<div class='michaeldmoore-annunciator-panel-limits-container'>\";\r\n\r\n      if (this.panel.LowerLimit.DisplayOption != 'disabled' && (this.panel.LowerLimit.FontSize != 'hide'))\r\n        html += this.getValueSpan('michaeldmoore-annunciator-panel-lower-limit', this.panel.LowerLimit.FontSize, this.panel.LowerLimit.Decimals, this.panel.LowerLimit.Value, \"LowerLimit\");\r\n\r\n      if (this.panel.UpperLimit.DisplayOption != 'disabled' && (this.panel.UpperLimit.FontSize != 'hide'))\r\n        html += this.getValueSpan('michaeldmoore-annunciator-panel-upper-limit', this.panel.UpperLimit.FontSize, this.panel.UpperLimit.Decimals, this.panel.UpperLimit.Value, \"UpperLimit\");\r\n\r\n      html += \"</div>\";\r\n\r\n      html += \"<div style='float:none;'/>\";\r\n    }\r\n    return html;\r\n  }\r\n\r\n  buildHtml() {\r\n    var html = \"<div class='michaeldmoore-annunciator-panel-container' style='height:100%;'>\";\r\n    if (this.data != null && this.data.value != null) {\r\n      html += this.buildLimitsHtml();\r\n      if ($.isNumeric(this.data.value))\r\n        html += this.buildValueHtml();\r\n      else\r\n        appEvents.emit('alert-warning', ['Annunciator Data Warning', 'Last data point is non-numeric']);\r\n    } else\r\n      html += '<div class=\"michaeldmoore-annunciator-panel-centered\">No data</div>';\r\n\r\n    html += \"</div>\";\r\n\r\n    this.elem.html(html);\r\n\r\n    if (this.panel.sparkline.show) {\r\n      this.addSparkline();\r\n    }\r\n  }\r\n\r\n  getTextSpan(className, fontSize, text, displayAttributes) {\r\n    var style = '';\r\n\r\n    if (fontSize)\r\n      style += \"font-size:\" + fontSize + \";\";\r\n\r\n    if (displayAttributes && displayAttributes.color)\r\n      style += \"color:\" + displayAttributes.color + \";\";\r\n\r\n    if (style)\r\n      style = ' style=\"' + style + '\"';\r\n\r\n    if (displayAttributes && displayAttributes.displayOption)\r\n      className += \" michaeldmoore-annunciator-\" + displayAttributes.displayOption.replace(' & ', 'and');\r\n\r\n    return '<span class=\"' + className + '\"' + style + '>' + text + '</span>';\r\n  }\r\n\r\n  getValueSpan(className, fontSize, decimals, value, metric) {\r\n    var displayAttributes = this.getDisplayAttributesForValue(value, metric);\r\n    return this.getTextSpan(className, fontSize, this.formatValue(value, decimals), displayAttributes);\r\n  }\r\n\r\n  setOKValueRange() {\r\n    var OKLowerLimit;\r\n    if (this.panel.LowerLimit.DisplayOption != 'disabled') {\r\n      if ($.isNumeric(this.panel.LowerLimit.Value)) {\r\n        if (this.panel.LowerWarning.DisplayOption != 'disabled') {\r\n          if ($.isNumeric(this.panel.LowerWarning.Value))\r\n            if (Number(this.panel.LowerWarning.Value) > Number(this.panel.LowerLimit.Value))\r\n              OKLowerLimit = this.panel.LowerWarning.Value;\r\n            else\r\n              appEvents.emit('alert-warning', ['Annunciator Data Warning', 'LowerWarning Value should be greater than LowerLimit Value']);\r\n          else\r\n            appEvents.emit('alert-warning', ['Annunciator Data Warning', 'LowerWarning Value is non-numeric']);\r\n        } else\r\n          OKLowerLimit = this.panel.LowerLimit.Value;\r\n      } else {\r\n        appEvents.emit('alert-warning', ['Annunciator Data Warning', 'LowerLimit Value is non-numeric']);\r\n      }\r\n    }\r\n\r\n    var OKUpperLimit;\r\n    if (this.panel.UpperLimit.DisplayOption != 'disabled') {\r\n      if ($.isNumeric(this.panel.UpperLimit.Value)) {\r\n        if (this.panel.UpperWarning.DisplayOption != 'disabled') {\r\n          if ($.isNumeric(this.panel.UpperWarning.Value))\r\n            if (Number(this.panel.UpperWarning.Value) < Number(this.panel.UpperLimit.Value))\r\n              OKUpperLimit = this.panel.UpperWarning.Value;\r\n            else\r\n              appEvents.emit('alert-warning', ['Annunciator Data Warning', 'UpperWarning Value should be less than UpperLimit Value']);\r\n          else\r\n            appEvents.emit('alert-warning', ['Annunciator Data Warning', 'UpperWarning Value is non-numeric']);\r\n        } else\r\n          OKUpperLimit = this.panel.UpperLimit.Value;\r\n      } else {\r\n        appEvents.emit('alert-warning', ['Annunciator Data Warning', 'UpperLimit Value is non-numeric']);\r\n      }\r\n    }\r\n\r\n    if ($.isNumeric(OKLowerLimit) && $.isNumeric(OKUpperLimit))\r\n      this.panel.MetricValueRange = OKLowerLimit + ' -> ' + OKUpperLimit;\r\n    else if ($.isNumeric(OKLowerLimit))\r\n      this.panel.MetricValueRange = '> ' + OKLowerLimit;\r\n    else if ($.isNumeric(OKUpperLimit))\r\n      this.panel.MetricValueRange = '< ' + OKUpperLimit;\r\n    else\r\n      this.panel.MetricValueRange = '';\r\n  }\r\n\r\n  onRender() {\r\n    var data = {};\r\n    if (this.dataList.length > 0) {\r\n      this.dataList[0].datapoints = this.dataPoints.filter(dp => dp[1] >= this.range.from && dp[1] <= this.range.to);\r\n      if (this.dataList[0].datapoints.length > 0) {\r\n        this.series = this.dataList.map(this.seriesHandler.bind(this));\r\n        this.setValues(data);\r\n      }\r\n    }\r\n\r\n    this.data = data;\r\n\r\n    this.buildHtml();\r\n    this.setOKValueRange();\r\n    this.ctrl.renderingCompleted();\r\n  }\r\n\r\n\r\n  onDataReceived(dataList) {\r\n    this.dataList = dataList;\r\n    if (dataList.length > 0) {\r\n      this.dataPoints = dataList[0].datapoints;\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  seriesHandler(seriesData) {\r\n    var series = new TimeSeries({\r\n      datapoints: seriesData.datapoints,\r\n      alias: seriesData.target,\r\n    });\r\n\r\n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\r\n    return series;\r\n  }\r\n\r\n  getDecimalsForValue(value, decimals) {\r\n    if (_.isNumber(decimals)) {\r\n      return {\r\n        decimals: decimals,\r\n        scaledDecimals: null\r\n      };\r\n    }\r\n\r\n    var delta = value / 2;\r\n    var dec = -Math.floor(Math.log(delta) / Math.LN10);\r\n\r\n    var magn = Math.pow(10, -dec),\r\n      norm = delta / magn, // norm is between 1.0 and 10.0\r\n      size;\r\n\r\n    if (norm < 1.5) {\r\n      size = 1;\r\n    } else if (norm < 3) {\r\n      size = 2;\r\n      // special case for 2.5, requires an extra decimal\r\n      if (norm > 2.25) {\r\n        size = 2.5;\r\n        ++dec;\r\n      }\r\n    } else if (norm < 7.5) {\r\n      size = 5;\r\n    } else {\r\n      size = 10;\r\n    }\r\n\r\n    size *= magn;\r\n\r\n    // reduce starting decimals if not needed\r\n    if (Math.floor(value) === value) {\r\n      dec = 0;\r\n    }\r\n\r\n    var result = {};\r\n    result.decimals = Math.max(0, dec);\r\n    result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\r\n\r\n    return result;\r\n  }\r\n\r\n  formatValue(value, decimals) {\r\n    // crude work-around for kbn formatting function error - preserve decimal places even for whole numbers\r\n    //if (value == 0 && decimals > 0)\r\n    //    value += 0.000000000000001;\r\n    var decimalInfo = this.getDecimalsForValue(value, decimals);\r\n    var formatFunc = kbn.valueFormats[this.panel.Metric.Format];\r\n    return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\r\n  }\r\n\r\n  setValues(data) {\r\n    data.flotpairs = [];\r\n\r\n    if (this.series.length > 1) {\r\n      appEvents.emit('alert-error', ['Annunciator Multiple Series Error',\r\n        'Metric query returns ' + this.series.length + ' series. Annunciator Panel expects a single series.\\n\\nResponse:\\n' + JSON.stringify(this.series)\r\n      ]);\r\n    }\r\n\r\n    if (this.series && this.series.length > 0) {\r\n      var lastPoint = _.last(this.series[0].datapoints);\r\n      var lastValue = _.isArray(lastPoint) ? lastPoint[0] : null;\r\n\r\n      if (_.isString(lastValue)) {\r\n        data.value = 0;\r\n        data.valueFormatted = _.escape(lastValue);\r\n        data.valueRounded = 0;\r\n      } else {\r\n        data.value = this.series[0].stats[this.panel.Metric.Name];\r\n        data.flotpairs = this.series[0].flotpairs;\r\n\r\n        if (data == null || data.value == null) {\r\n          data.value = 0.0;\r\n        }\r\n\r\n        var decimalInfo = this.getDecimalsForValue(data.value, this.panel.Metric.Decimals);\r\n        var formatFunc = kbn.valueFormats[this.panel.Metric.Format];\r\n        data.valueFormatted = formatFunc(data.value, decimalInfo.decimals, decimalInfo.scaledDecimals);\r\n        data.valueRounded = kbn.roundValue(data.value, decimalInfo.decimals);\r\n      }\r\n\r\n      if (data == null || data.value == null) {\r\n        data.value = 0.0;\r\n      }\r\n\r\n      // Add $__name variable for using in prefix or postfix\r\n      //data.scopedVars = _.extend({}, this.panel.scopedVars);\r\n      //data.scopedVars[\"__name\"] = {\r\n      //    value: this.series[0].label\r\n      //};\r\n    }\r\n  }\r\n\r\n  addSparkline() {\r\n    if (this.elem == null || this.elem.width() < 10) {\r\n      // element has not gotten it's width yet\r\n      // delay sparkline render\r\n      setTimeout(this.addSparkline, 30);\r\n      return;\r\n    }\r\n\r\n    var width = this.elem.width() + 20;\r\n    var height = this.elem.height();\r\n    var plotCanvas = $('<div></div>');\r\n    var plotCss = {};\r\n    plotCss.position = 'absolute';\r\n\r\n    if (this.panel.sparkline.full) {\r\n      plotCss.bottom = '5px';\r\n      plotCss.left = '-5px';\r\n      plotCss.width = (width - 10) + 'px';\r\n      var dynamicHeightMargin = height <= 100 ? 5 : (Math.round((height / 100)) * 15) + 5;\r\n      plotCss.height = (height - dynamicHeightMargin) + 'px';\r\n    } else {\r\n      plotCss.bottom = \"0px\";\r\n      plotCss.left = \"-5px\";\r\n      plotCss.width = (width - 10) + 'px';\r\n      plotCss.height = Math.floor(height * 0.25) + 'px';\r\n    }\r\n\r\n    plotCanvas.css(plotCss);\r\n\r\n    var options = {\r\n      legend: {\r\n        show: false\r\n      },\r\n      series: {\r\n        lines: {\r\n          show: true,\r\n          fill: 1,\r\n          lineWidth: 1,\r\n          fillColor: this.panel.sparkline.fillColor,\r\n        },\r\n      },\r\n      yaxes: {\r\n        show: false\r\n      },\r\n      xaxis: {\r\n        show: false,\r\n        mode: \"time\",\r\n        min: this.ctrl.range.from.valueOf(),\r\n        max: this.ctrl.range.to.valueOf(),\r\n      },\r\n      grid: {\r\n        hoverable: false,\r\n        show: false\r\n      },\r\n    };\r\n\r\n    this.elem.find('.michaeldmoore-annunciator-panel-container').append(plotCanvas);\r\n\r\n    var plotSeries = {\r\n      data: this.data.flotpairs,\r\n      color: this.panel.sparkline.lineColor\r\n    };\r\n\r\n    $.plot(plotCanvas, [plotSeries], options);\r\n  }\r\n\r\n  onConfigChanged() {\r\n    this.refresh();\r\n  }\r\n\r\n  link(scope, elem, attrs, ctrl) {\r\n    this.ctrl = ctrl;\r\n    this.elem = elem;\r\n\r\n    // for backward compatability (grafana 6.6.0 and earlier)\r\n    var panelContentElem = elem.find('.panel-content');\r\n    if (panelContentElem.length)\r\n      this.elem = panelContentElem;\r\n  }\r\n}\r\n\r\nAnnunciatorPanelCtrl.templateUrl = 'module.html';\r\n\r\nexport {\r\n  AnnunciatorPanelCtrl as PanelCtrl\r\n};"]}